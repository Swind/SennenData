!function(e){function t(e){var t=document.getElementsByTagName("head")[0],n=document.createElement("script");n.type="text/javascript",n.charset="utf-8",n.src=m.p+""+e+"."+k+".hot-update.js",t.appendChild(n)}function n(e){if("undefined"==typeof XMLHttpRequest)return e(new Error("No browser support"));try{var t=new XMLHttpRequest,n=m.p+""+k+".hot-update.json";t.open("GET",n,!0),t.timeout=1e4,t.send(null)}catch(a){return e(a)}t.onreadystatechange=function(){if(4===t.readyState)if(0===t.status)e(new Error("Manifest request to "+n+" timed out."));else if(404===t.status)e();else if(200!==t.status&&304!==t.status)e(new Error("Manifest request to "+n+" failed."));else{try{var a=JSON.parse(t.responseText)}catch(i){return void e(i)}e(null,a)}}}function a(e){var t=O[e];if(!t)return m;var n=function(n){return t.hot.active?O[n]?(O[n].parents.indexOf(e)<0&&O[n].parents.push(e),t.children.indexOf(n)<0&&t.children.push(n)):b=[e]:(console.warn("[HMR] unexpected require("+n+") from disposed module "+e),b=[]),m(n)};for(var a in m)Object.prototype.hasOwnProperty.call(m,a)&&(n[a]=m[a]);return n.e=function(e,t){"ready"===E&&o("prepare"),I++,m.e(e,function(){function a(){I--,"prepare"===E&&(D[e]||c(e),0===I&&0===N&&p())}try{t.call(null,n)}finally{a()}})},n}function i(e){var t={_acceptedDependencies:{},_declinedDependencies:{},_selfAccepted:!1,_selfDeclined:!1,_disposeHandlers:[],active:!0,accept:function(e,n){if("undefined"==typeof e)t._selfAccepted=!0;else if("function"==typeof e)t._selfAccepted=e;else if("object"==typeof e)for(var a=0;a<e.length;a++)t._acceptedDependencies[e[a]]=n;else t._acceptedDependencies[e]=n},decline:function(e){if("undefined"==typeof e)t._selfDeclined=!0;else if("number"==typeof e)t._declinedDependencies[e]=!0;else for(var n=0;n<e.length;n++)t._declinedDependencies[e[n]]=!0},dispose:function(e){t._disposeHandlers.push(e)},addDisposeHandler:function(e){t._disposeHandlers.push(e)},removeDisposeHandler:function(e){var n=t._disposeHandlers.indexOf(e);n>=0&&t._disposeHandlers.splice(n,1)},check:s,apply:u,status:function(e){return e?void x.push(e):E},addStatusHandler:function(e){x.push(e)},removeStatusHandler:function(e){var t=x.indexOf(e);t>=0&&x.splice(t,1)},data:y[e]};return t}function o(e){E=e;for(var t=0;t<x.length;t++)x[t].call(null,e)}function l(e){var t=+e+""===e;return t?+e:e}function s(e,t){if("idle"!==E)throw new Error("check() is only allowed in idle status");"function"==typeof e?(g=!1,t=e):(g=e,t=t||function(e){if(e)throw e}),o("check"),n(function(e,n){if(e)return t(e);if(!n)return o("idle"),void t(null,null);w={},C={},D={};for(var a=0;a<n.c.length;a++)C[n.c[a]]=!0;v=n.h,o("prepare"),h=t,_={};for(var i in M)c(i);"prepare"===E&&0===I&&0===N&&p()})}function r(e,t){if(C[e]&&w[e]){w[e]=!1;for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(_[n]=t[n]);0===--N&&0===I&&p()}}function c(e){C[e]?(w[e]=!0,N++,t(e)):D[e]=!0}function p(){o("ready");var e=h;if(h=null,e)if(g)u(g,e);else{var t=[];for(var n in _)Object.prototype.hasOwnProperty.call(_,n)&&t.push(l(n));e(null,t)}}function u(t,n){function a(e){for(var t=[e],n={},a=t.slice();a.length>0;){var o=a.pop(),e=O[o];if(e&&!e.hot._selfAccepted){if(e.hot._selfDeclined)return new Error("Aborted because of self decline: "+o);if(0===o)return;for(var l=0;l<e.parents.length;l++){var s=e.parents[l],r=O[s];if(r.hot._declinedDependencies[o])return new Error("Aborted because of declined dependency: "+o+" in "+s);t.indexOf(s)>=0||(r.hot._acceptedDependencies[o]?(n[s]||(n[s]=[]),i(n[s],[o])):(delete n[s],t.push(s),a.push(s)))}}}return[t,n]}function i(e,t){for(var n=0;n<t.length;n++){var a=t[n];e.indexOf(a)<0&&e.push(a)}}if("ready"!==E)throw new Error("apply() is only allowed in ready status");"function"==typeof t?(n=t,t={}):t&&"object"==typeof t?n=n||function(e){if(e)throw e}:(t={},n=n||function(e){if(e)throw e});var s={},r=[],c={};for(var p in _)if(Object.prototype.hasOwnProperty.call(_,p)){var u=l(p),d=a(u);if(!d){if(t.ignoreUnaccepted)continue;return o("abort"),n(new Error("Aborted because "+u+" is not accepted"))}if(d instanceof Error)return o("abort"),n(d);c[u]=_[u],i(r,d[0]);for(var u in d[1])Object.prototype.hasOwnProperty.call(d[1],u)&&(s[u]||(s[u]=[]),i(s[u],d[1][u]))}for(var f=[],h=0;h<r.length;h++){var u=r[h];O[u]&&O[u].hot._selfAccepted&&f.push({module:u,errorHandler:O[u].hot._selfAccepted})}o("dispose");for(var g=r.slice();g.length>0;){var u=g.pop(),x=O[u];if(x){for(var N={},I=x.hot._disposeHandlers,D=0;D<I.length;D++){var w=I[D];w(N)}y[u]=N,x.hot.active=!1,delete O[u];for(var D=0;D<x.children.length;D++){var C=O[x.children[D]];if(C){var M=C.parents.indexOf(u);M>=0&&C.parents.splice(M,1)}}}}for(var u in s)if(Object.prototype.hasOwnProperty.call(s,u))for(var x=O[u],R=s[u],D=0;D<R.length;D++){var P=R[D],M=x.children.indexOf(P);M>=0&&x.children.splice(M,1)}o("apply"),k=v;for(var u in c)Object.prototype.hasOwnProperty.call(c,u)&&(e[u]=c[u]);var T=null;for(var u in s)if(Object.prototype.hasOwnProperty.call(s,u)){for(var x=O[u],R=s[u],S=[],h=0;h<R.length;h++){var P=R[h],w=x.hot._acceptedDependencies[P];S.indexOf(w)>=0||S.push(w)}for(var h=0;h<S.length;h++){var w=S[h];try{w(s)}catch(A){T||(T=A)}}}for(var h=0;h<f.length;h++){var V=f[h],u=V.module;b=[u];try{m(u)}catch(A){if("function"==typeof V.errorHandler)try{V.errorHandler(A)}catch(A){T||(T=A)}else T||(T=A)}}return T?(o("fail"),n(T)):(o("idle"),void n(null,r))}function m(t){if(O[t])return O[t].exports;var n=O[t]={exports:{},id:t,loaded:!1,hot:i(t),parents:b,children:[]};return e[t].call(n.exports,n,n.exports,a(t)),n.loaded=!0,n.exports}var d=window.webpackJsonp;window.webpackJsonp=function(t,n){for(var a,i,o=0,l=[];o<t.length;o++)i=t[o],M[i]&&l.push.apply(l,M[i]),M[i]=0;for(a in n)e[a]=n[a];for(d&&d(t,n);l.length;)l.shift().call(null,m);return n[0]?(O[0]=0,m(0)):void 0};var f=this.webpackHotUpdate;this.webpackHotUpdate=function(e,t){r(e,t),f&&f(e,t)};var h,_,v,g=!0,k="36669e8c2dcd04c740d7",y={},b=[],x=[],E="idle",N=0,I=0,D={},w={},C={},O={},M={2:0};return m.e=function(e,t){if(0===M[e])return t.call(null,m);if(void 0!==M[e])M[e].push(t);else{M[e]=[t];var n=document.getElementsByTagName("head")[0],a=document.createElement("script");a.type="text/javascript",a.charset="utf-8",a.async=!0,a.src=m.p+""+e+"."+({0:"bundle",1:"onlyDevServer",3:"webpackDevServer"}[e]||e)+".js",n.appendChild(a)}},m.m=e,m.c=O,m.p="",m.h=function(){return k},a(0)(0)}({0:function(e,t,n){e.exports=n(168)},168:function(e,t){!function(n,a){"function"==typeof define&&define.amd?define([],a):"object"==typeof t?e.exports=a():n.loki=a()}(this,function(){return function(){"use strict";function e(e,t,n){return e===t?n?!0:!1:void 0===e?!0:void 0===t?!1:null===e?!0:null===t?!1:t>e}function t(e,t,n){return e===t?n?!0:!1:void 0===e?!1:void 0===t?!0:null===e?!1:null===t?!0:e>t}function n(n,a,i){return n===a?0:i?e(n,a)?1:-1:t(n,a)?1:-1}function a(e,t){return Array.isArray(e)?function(t){return-1!==e.indexOf(t)}:e&&"string"==typeof e?function(t){return-1!==e.indexOf(t)}:e&&"object"==typeof e?function(t){return e.hasOwnProperty(t)}:void 0}function i(e,t){var n,a=t||"parse-stringify";return"parse-stringify"===a&&(n=JSON.parse(JSON.stringify(e))),n}function o(){try{return"localStorage"in window&&null!==window.localStorage}catch(e){return!1}}function l(){}function s(e,t){this.filename=e||"loki.db",this.collections=[],this.databaseVersion=1.1,this.engineVersion=1.1,this.autosave=!1,this.autosaveInterval=5e3,this.autosaveHandle=null,this.options={},this.persistenceMethod=null,this.persistenceAdapter=null,this.events={init:[],flushChanges:[],close:[],changes:[],warning:[]};var n=function(){return"undefined"==typeof window?"NODEJS":"undefined"!=typeof global&&global.window?"NODEJS":"undefined"!=typeof document?-1===document.URL.indexOf("http://")&&-1===document.URL.indexOf("https://")?"CORDOVA":"BROWSER":"CORDOVA"};t&&t.hasOwnProperty("env")?this.ENV=t.env:this.ENV=n(),"undefined"===this.ENV&&(this.ENV="NODEJS"),this.configureOptions(t,!0),this.on("init",this.clearChanges)}function r(){this.fs=require("fs")}function c(){}function p(e,t,n,a){return this.collection=e,this.searchIsChained=!t&&!n,this.filteredrows=[],this.filterInitialized=!1,"undefined"!=typeof t&&null!==t?this.find(t,a):"undefined"!=typeof n&&null!==n?this.where(n):this}function u(e,t,n){this.collection=e,this.name=t,this.rebuildPending=!1,this.options=n||{},this.options.hasOwnProperty("persistent")||(this.options.persistent=!1),this.options.hasOwnProperty("sortPriority")||(this.options.sortPriority="passive"),this.resultset=new p(e),this.resultdata=[],this.resultsdirty=!1,this.cachedresultset=null,this.filterPipeline=[],this.sortFunction=null,this.sortCriteria=null,this.sortDirty=!1,this.events={rebuild:[]}}function m(e,t){function n(e,t,n){u.changes.push({name:e,operation:t,obj:JSON.parse(JSON.stringify(n))})}function a(){u.changes=[]}function i(e){e&&(e.meta||(e.meta={}),e.meta.created=(new Date).getTime(),e.meta.revision=0)}function o(e){e&&(e.meta.updated=(new Date).getTime(),e.meta.revision+=1)}function l(e){n(u.name,"I",e)}function s(e){n(u.name,"U",e)}function r(e){i(e),l(e)}function c(e){o(e),s(e)}function p(){f=u.disableChangesApi?i:r,h=u.disableChangesApi?o:c}this.name=e,this.data=[],this.idIndex=[],this.binaryIndices={},this.constraints={unique:{},exact:{}},this.uniqueNames=[],this.transforms={},this.objType=e,this.dirty=!0,this.cachedIndex=null,this.cachedBinaryIndex=null,this.cachedData=null;var u=this;t=t||{},t.hasOwnProperty("unique")&&(Array.isArray(t.unique)||(t.unique=[t.unique]),t.unique.forEach(function(e){u.uniqueNames.push(e),u.constraints.unique[e]=new E(e)})),t.hasOwnProperty("exact")&&t.exact.forEach(function(e){u.constraints.exact[e]=new N(e)}),this.transactional=t.hasOwnProperty("transactional")?t.transactional:!1,this.cloneObjects=t.hasOwnProperty("clone")?t.clone:!1,this.asyncListeners=t.hasOwnProperty("asyncListeners")?t.asyncListeners:!1,this.disableChangesApi=t.hasOwnProperty("disableChangesApi")?t.disableChangesApi:!0,this.maxId=0,this.DynamicViews=[],this.events={insert:[],update:[],"pre-insert":[],"pre-update":[],close:[],flushbuffer:[],error:[],"delete":[],warning:[]},this.changes=[],this.ensureId();var m=[];if(t&&t.indices)if("[object Array]"===Object.prototype.toString.call(t.indices))m=t.indices;else{if("string"!=typeof t.indices)throw new TypeError("Indices needs to be a string or an array of strings");m=[t.indices]}for(var d=0;d<m.length;d++)this.ensureIndex(m[d]);this.getChanges=function(){return u.changes},this.flushChanges=a;var f,h;p(),this.setChangesApi=function(e){u.disableChangesApi=!e,p()},this.on("insert",function(e){f(e)}),this.on("update",function(e){h(e)}),this.on("delete",function(e){u.disableChangesApi||n(u.name,"R",e)}),this.on("warning",console.warn),a()}function d(e){return-1!==e.indexOf(".")}function f(e){return parseFloat(e,10)}function h(e,t){return e+t}function _(e,t){return e-t}function v(e){return e.reduce(h,0)/e.length}function g(e){var t=v(e),n=e.map(function(e){var n=e-t,a=n*n;return a}),a=v(n),i=Math.sqrt(a);return i}function k(e,t,n){if(n===!1)return e[t];for(var a=t.split("."),i=e;a.length>0;)i=i[a.shift()];return i}function y(e,t,n){for(var a,i,o=0,l=e.length;l>o;){if(i=(o+l)/2|0,a=n.apply(null,[t,e[i]]),0===a)return{found:!0,index:i};0>a?l=i:o=i+1}return{found:!1,index:l}}function b(e){return function(t,n){return y(t,n,e)}}function x(){}function E(e){this.field=e,this.keyMap={},this.lokiMap={}}function N(e){this.index={},this.field=e}function I(e){this.field=e}var D={copyProperties:function(e,t){var n;for(n in e)t[n]=e[n]},resolveTransformObject:function(e,t,n){var a,i;if("number"!=typeof n&&(n=0),++n>=10)return e;for(a in e)"string"==typeof e[a]&&0===e[a].indexOf("[%lktxp]")?(i=e[a].substring(8),t.hasOwnProperty(i)&&(e[a]=t[i])):"object"==typeof e[a]&&(e[a]=D.resolveTransformObject(e[a],t,n));return e},resolveTransformParams:function(e,t){var n,a,i=[];if("undefined"==typeof t)return e;for(n=0;n<e.length;n++)a=JSON.parse(JSON.stringify(e[n])),i.push(D.resolveTransformObject(a,t));return i}},w={$eq:function(e,t){return e===t},$gt:function(e,n){return t(e,n)},$gte:function(e,n){return t(e,n,!0)},$lt:function(t,n){return e(t,n)},$lte:function(t,n){return e(t,n,!0)},$ne:function(e,t){return e!==t},$regex:function(e,t){return t.test(e)},$in:function(e,t){return t.indexOf(e)>-1},$containsAny:function(e,t){var n;return Array.isArray(t)||(t=[t]),n=a(e,t)||function(){return!1},t.reduce(function(e,t){return e?e:n(t)},!1)},$contains:function(e,t){var n;return Array.isArray(t)||(t=[t]),n=a(e,t)||function(){return!1},t.reduce(function(e,t){return e?n(t):e},!0)}},C={$eq:w.$eq,$gt:w.$gt,$gte:w.$gte,$lt:w.$lt,$lte:w.$lte,$ne:w.$ne,$regex:w.$regex,$in:w.$in,$contains:w.$contains,$containsAny:w.$containsAny},O=["$eq","$gt","$gte","$lt","$lte"];return l.prototype.events={},l.prototype.asyncListeners=!1,l.prototype.on=function(e,t){var n=this.events[e];return n||(n=this.events[e]=[]),n.push(t),t},l.prototype.emit=function(e,t){var n=this;if(!e||!this.events[e])throw new Error("No event "+e+" defined");this.events[e].forEach(function(e){n.asyncListeners?setTimeout(function(){e(t)},1):e(t)})},l.prototype.removeListener=function(e,t){if(this.events[e]){var n=this.events[e];n.splice(n.indexOf(t),1)}},s.prototype=new l,s.prototype.getIndexedAdapter=function(){var e;return"function"==typeof require&&(e=require("./loki-indexed-adapter.js")),e},s.prototype.configureOptions=function(e,t){var n={NODEJS:"fs",BROWSER:"localStorage",CORDOVA:"localStorage"},a={fs:r,localStorage:c};if(this.options={},this.persistenceMethod=null,this.persistenceAdapter=null,"undefined"!=typeof e){if(this.options=e,this.options.hasOwnProperty("persistenceMethod")&&"function"==typeof a[e.persistenceMethod]&&(this.persistenceMethod=e.persistenceMethod,this.persistenceAdapter=new a[e.persistenceMethod]),this.options.hasOwnProperty("adapter")&&(this.persistenceMethod="adapter",this.persistenceAdapter=e.adapter),e.hasOwnProperty("autoload")&&"undefined"!=typeof t&&t){var i=this;setTimeout(function(){i.loadDatabase(e,e.autoloadCallback)},1)}this.options.hasOwnProperty("autosaveInterval")&&(this.autosaveDisable(),this.autosaveInterval=parseInt(this.options.autosaveInterval,10)),this.options.hasOwnProperty("autosave")&&this.options.autosave&&(this.autosaveDisable(),this.autosave=!0,this.options.hasOwnProperty("autosaveCallback")?this.autosaveEnable(e,e.autosaveCallback):this.autosaveEnable())}null===this.persistenceAdapter&&(this.persistenceMethod=n[this.ENV],this.persistenceMethod&&(this.persistenceAdapter=new a[this.persistenceMethod]))},s.prototype.anonym=function(e,t){var n=new m("anonym",t);return n.insert(e),n},s.prototype.addCollection=function(e,t){var n=new m(e,t);return this.collections.push(n),n},s.prototype.loadCollection=function(e){if(!e.name)throw new Error("Collection must have a name property to be loaded");this.collections.push(e)},s.prototype.getCollection=function(e){var t,n=this.collections.length;for(t=0;n>t;t+=1)if(this.collections[t].name===e)return this.collections[t];return this.emit("warning","collection "+e+" not found"),null},s.prototype.listCollections=function(){for(var e=this.collections.length,t=[];e--;)t.push({name:this.collections[e].name,type:this.collections[e].objType,count:this.collections[e].data.length});return t},s.prototype.removeCollection=function(e){var t,n=this.collections.length;for(t=0;n>t;t+=1)if(this.collections[t].name===e)return void this.collections.splice(t,1)},s.prototype.getName=function(){return this.name},s.prototype.serializeReplacer=function(e,t){switch(e){case"autosaveHandle":case"persistenceAdapter":case"constraints":return null;default:return t}},s.prototype.serialize=function(){return JSON.stringify(this,this.serializeReplacer)},s.prototype.toJson=s.prototype.serialize,s.prototype.loadJSON=function(e,t){0===e.length&&(e=JSON.stringify({}));var n,a,i,o,l=JSON.parse(e),s=0,r=l.collections?l.collections.length:0;for(this.name=l.name,this.databaseVersion=1,l.hasOwnProperty("databaseVersion")&&(this.databaseVersion=l.databaseVersion),this.collections=[],s;r>s;s+=1){if(n=l.collections[s],a=this.addCollection(n.name),i=n.data.length,o=0,t&&t.hasOwnProperty(n.name)){var c=t[n.name].inflate?t[n.name].inflate:D.copyProperties;for(o;i>o;o++){var p=new t[n.name].proto;c(n.data[o],p),a.data[o]=p}}else for(o;i>o;o++)a.data[o]=n.data[o];if(a.transactional=n.transactional,a.asyncListeners=n.asyncListeners,a.disableChangesApi=n.disableChangesApi,a.cloneObjects=n.cloneObjects,a.maxId=0===n.data.length?0:n.maxId,a.idIndex=n.idIndex,"undefined"!=typeof n.binaryIndices&&(a.binaryIndices=n.binaryIndices),"undefined"!=typeof n.transforms&&(a.transforms=n.transforms),a.ensureId(),a.uniqueNames=[],n.hasOwnProperty("uniqueNames"))for(a.uniqueNames=n.uniqueNames,o=0;o<a.uniqueNames.length;o++)a.ensureUniqueIndex(a.uniqueNames[o]);if("undefined"!=typeof n.DynamicViews)for(var u=0;u<n.DynamicViews.length;u++){var m=n.DynamicViews[u],d=a.addDynamicView(m.name,m.options);d.resultdata=m.resultdata,d.resultsdirty=m.resultsdirty,d.filterPipeline=m.filterPipeline,d.sortCriteria=m.sortCriteria,d.sortFunction=null,d.sortDirty=m.sortDirty,d.resultset.filteredrows=m.resultset.filteredrows,d.resultset.searchIsChained=m.resultset.searchIsChained,d.resultset.filterInitialized=m.resultset.filterInitialized,d.rematerialize({removeWhereFilters:!0})}}},s.prototype.close=function(e){this.autosave&&(this.autosaveDisable(),this.autosaveDirty()&&this.saveDatabase()),e&&this.on("close",e),this.emit("close")},s.prototype.generateChangesNotification=function(e){function t(e){return e.name}var n=[],a=e||this.collections.map(t);return this.collections.forEach(function(e){-1!==a.indexOf(t(e))&&(n=n.concat(e.getChanges()))}),n},s.prototype.serializeChanges=function(e){return JSON.stringify(this.generateChangesNotification(e))},s.prototype.clearChanges=function(){this.collections.forEach(function(e){e.flushChanges&&e.flushChanges()})},r.prototype.loadDatabase=function(e,t){this.fs.readFile(e,{encoding:"utf8"},function(e,n){t(e?new Error(e):n)})},r.prototype.saveDatabase=function(e,t,n){this.fs.writeFile(e,t,n)},c.prototype.loadDatabase=function(e,t){t(o()?localStorage.getItem(e):new Error("localStorage is not available"))},c.prototype.saveDatabase=function(e,t,n){o()?(localStorage.setItem(e,t),n(null)):n(new Error("localStorage is not available"))},s.prototype.loadDatabase=function(e,t){var n=t||function(e,t){if(e)throw e},a=this;null!==this.persistenceAdapter?this.persistenceAdapter.loadDatabase(this.filename,function(t){"string"==typeof t?(a.loadJSON(t,e||{}),n(null)):(console.warn("lokijs loadDatabase : Database not found"),n("object"==typeof t?t:"Database not found"))}):n(new Error("persistenceAdapter not configured"))},s.prototype.saveDatabase=function(e){var t=e||function(e){if(e)throw e},n=this;null!==this.persistenceAdapter?this.persistenceAdapter.saveDatabase(this.filename,n.serialize(),function(){n.autosaveClearFlags(),t(null)}):t(new Error("persistenceAdapter not configured"))},s.prototype.save=s.prototype.saveDatabase,s.prototype.autosaveDirty=function(){for(var e=0;e<this.collections.length;e++)if(this.collections[e].dirty)return!0;return!1},s.prototype.autosaveClearFlags=function(){for(var e=0;e<this.collections.length;e++)this.collections[e].dirty=!1},s.prototype.autosaveEnable=function(e,t){this.autosave=!0;var n=5e3,a=this;"undefined"!=typeof this.autosaveInterval&&null!==this.autosaveInterval&&(n=this.autosaveInterval),this.autosaveHandle=setInterval(function(){a.autosaveDirty()&&a.saveDatabase(t)},n)},s.prototype.autosaveDisable=function(){"undefined"!=typeof this.autosaveHandle&&null!==this.autosaveHandle&&(clearInterval(this.autosaveHandle),this.autosaveHandle=null)},p.prototype.toJSON=function(){var e=this.copy();return e.collection=null,e},p.prototype.limit=function(e){this.searchIsChained&&!this.filterInitialized&&0===this.filteredrows.length&&(this.filteredrows=Object.keys(this.collection.data));var t=this.copy();return t.filteredrows=t.filteredrows.slice(0,e),t},p.prototype.offset=function(e){this.searchIsChained&&!this.filterInitialized&&0===this.filteredrows.length&&(this.filteredrows=Object.keys(this.collection.data));var t=this.copy();return t.filteredrows=t.filteredrows.splice(e,t.filteredrows.length),t},p.prototype.copy=function(){var e=new p(this.collection,null,null);return e.filteredrows=this.filteredrows.slice(),e.filterInitialized=this.filterInitialized,e},p.prototype.branch=p.prototype.copy,p.prototype.transform=function(e,t){var n,a,i=this;for("undefined"!=typeof t&&(e=D.resolveTransformParams(e,t)),n=0;n<e.length;n++)switch(a=e[n],a.type){case"find":i.find(a.value);break;case"where":i.where(a.value);break;case"simplesort":i.simplesort(a.property,a.desc);break;case"compoundsort":i.compoundsort(a.value);break;case"sort":i.sort(a.value);break;case"limit":i=i.limit(a.value);break;case"offset":i=i.offset(a.value);break;case"map":i=i.map(a.value);break;case"eqJoin":i=i.eqJoin(a.joinData,a.leftJoinKey,a.rightJoinKey,a.mapFun);break;case"mapReduce":i=i.mapReduce(a.mapFunction,a.reduceFunction);break;case"update":i.update(a.value);break;case"remove":i.remove()}return i},p.prototype.sort=function(e){this.searchIsChained&&!this.filterInitialized&&0===this.filteredrows.length&&(this.filteredrows=Object.keys(this.collection.data));var t=function(e,t){return function(n,a){var i=t.collection.data[n],o=t.collection.data[a];return e(i,o)}}(e,this);return this.filteredrows.sort(t),this},p.prototype.simplesort=function(e,t){this.searchIsChained&&!this.filterInitialized&&0===this.filteredrows.length&&(this.filteredrows=Object.keys(this.collection.data)),"undefined"==typeof t&&(t=!1);var a=function(e,t,a){return function(i,o){var l=a.collection.data[i],s=a.collection.data[o];return n(l[e],s[e],t)}}(e,t,this);return this.filteredrows.sort(a),this},p.prototype.compoundeval=function(e,t,a){var i=e.length;if(0===i)throw new Error("Invalid call to compoundeval, need at least one property");var o=!1,l=e[0];return"string"!=typeof l&&Array.isArray(l)&&(o=l[1],l=l[0]),t[l]===a[l]?1===i?0:this.compoundeval(e.slice(1),t,a,o):n(t[l],a[l],o)},p.prototype.compoundsort=function(e){this.searchIsChained&&!this.filterInitialized&&0===this.filteredrows.length&&(this.filteredrows=Object.keys(this.collection.data));var t=function(e,t){return function(n,a){var i=t.collection.data[n],o=t.collection.data[a];return t.compoundeval(e,i,o)}}(e,this);return this.filteredrows.sort(t),this},p.prototype.calculateRange=function(n,a,i){var o=this.collection.data,l=this.collection.binaryIndices[a].values,s=0,r=l.length-1,c=null,p=0,u=l.length-1;if(0===o.length)return[0,-1];var m=o[l[s]][a],d=o[l[r]][a];switch(n){case"$eq":if(e(i,m)||t(i,d))return[0,-1];break;case"$gt":if(t(i,d,!0))return[0,-1];break;case"$gte":if(t(i,d))return[0,-1];break;case"$lt":if(e(i,m,!0))return[0,-1];if(e(d,i))return[0,o.length-1];break;case"$lte":if(e(i,m))return[0,-1];if(e(d,i,!0))return[0,o.length-1]}for(;r>s;)c=Math.floor((s+r)/2),e(o[l[c]][a],i)?s=c+1:r=c;for(p=s,s=0,r=l.length-1;r>s;)c=Math.floor((s+r)/2),e(i,o[l[c]][a])?r=c:s=c+1;u=r;var f=o[l[p]][a],h=o[l[u]][a];switch(n){case"$eq":return f!==i?[0,-1]:(h!==i&&u--,[p,u]);case"$gt":return e(h,i,!0)?[0,-1]:[u,o.length-1];case"$gte":return e(f,i)?[0,-1]:[p,o.length-1];case"$lt":return 0===p&&e(f,i)?[0,0]:[0,p-1];case"$lte":return h!==i&&u--,0===u&&e(h,i)?[0,0]:[0,u];default:return[0,o.length-1]}},p.prototype.findOr=function(e){var t=0,n=0,a=null,i=[],o=null;if(this.filterInitialized){for(i=[],n=0;n<e.length;n++)for(o=this.branch(),o.find(e[n]),o.data(),a=o.filteredrows,t=0;t<a.length;t++)-1===i.indexOf(a[t])&&i.push(a[t]);this.filteredrows=i}else for(n=0;n<e.length;n++)for(o=this.collection.chain(),o.find(e[n]),o.data(),a=o.filteredrows,t=0;t<a.length;t++)-1===this.filteredrows.indexOf(a[t])&&this.filteredrows.push(a[t]);return this.filterInitialized=!0,this},p.prototype.findAnd=function(e){for(var t=0;t<e.length;t++)this.find(e[t]);return this},p.prototype.dotSubScan=function(e,t,n,a){var i,o,l,s=null,r=t.split(".");for(i=0;i<r.length;i++)if(l=r[i],s){for(o=0;o<s.length;o++)if(n(s[o][l],a))return!0}else e=e[l],Array.isArray(e)&&(s=e);return n(e,a)},p.prototype.find=function(e,t){if(0===this.collection.data.length)return this.searchIsChained?(this.filteredrows=[],this.filterInitialized=!0,this):[];var n,a,i,o,l,s,r,c,p=e||"getAll",u=!1,m=[],d=null,f=!0;t=t||!1;for(o in p){f=!1;break}if(f&&(p="getAll"),"getAll"===p)return this.searchIsChained?(this.filteredrows=Object.keys(this.collection.data),this):this.collection.data;var h=!1;for(o in p)if(p.hasOwnProperty(o)){if(n=o,"$and"===o)return this.searchIsChained?(this.findAnd(p[o]),t&&this.filteredrows.length>1&&(this.filteredrows=this.filteredrows.slice(0,1)),this):(m=this.collection.chain().findAnd(p[o]).data(),t?0===m.length?[]:m[0]:m);if("$or"===o)return this.searchIsChained?(this.findOr(p[o]),t&&this.filteredrows.length>1&&(this.filteredrows=this.filteredrows.slice(0,1)),this):(m=this.collection.chain().findOr(p[o]).data(),t?0===m.length?[]:m[0]:m);if(-1!=o.indexOf(".")&&(h=!0),null===p[o]||"object"!=typeof p[o])i="$eq",a=p[o];else{if("object"!=typeof p[o])throw"Do not know what you want to do.";for(l in p[o])p[o].hasOwnProperty(l)&&(i=l,a=p[o][l])}break}if("$regex"===i&&(a=new RegExp(a)),null===this.collection.data)throw new TypeError;if((!this.searchIsChained||this.searchIsChained&&!this.filterInitialized)&&-1!==O.indexOf(i)&&this.collection.binaryIndices.hasOwnProperty(n)&&(this.collection.ensureIndex(n),u=!0,d=this.collection.binaryIndices[n]),s=C[i],this.searchIsChained){if(this.filterInitialized){if(u)for(r=d,c=this.filteredrows.length;c--;)s(r[this.filteredrows[c]],a)&&m.push(this.filteredrows[c]);else if(r=this.collection.data,c=this.filteredrows.length,h)for(;c--;)this.dotSubScan(r[this.filteredrows[c]],n,s,a)&&m.push(this.filteredrows[c]);else for(;c--;)s(r[this.filteredrows[c]][n],a)&&m.push(this.filteredrows[c]);return this.filteredrows=m,this}if(u){r=this.collection.data;for(var _=this.calculateRange(i,n,a,this),v=_[0];v<=_[1];v++)m.push(d.values[v]);this.filteredrows=m}else if(r=this.collection.data,c=r.length,h)for(;c--;)this.dotSubScan(r[c],n,s,a)&&m.push(c);else for(;c--;)s(r[c][n],a)&&m.push(c);return this.filteredrows=m,this.filterInitialized=!0,this}if(u){r=this.collection.data;var g=this.calculateRange(i,n,a,this);if(t)return-1!==g[1]?r[d.values[g[0]]]:[];for(c=g[0];c<=g[1];c++)m.push(r[d.values[c]]);this.filteredrows=m}else{if(r=this.collection.data,c=r.length,t){if(h){for(;c--;)if(this.dotSubScan(r[c],n,s,a))return r[c]}else for(;c--;)if(s(r[c][n],a))return r[c];return[]}if(h)for(;c--;)this.dotSubScan(r[c],n,s,a)&&m.push(r[c]);else for(;c--;)s(r[c][n],a)&&m.push(r[c])}return m},p.prototype.where=function(e){var t,n=[];if("function"!=typeof e)throw"Argument is not a stored view or a function";t=e;try{if(this.searchIsChained){if(this.filterInitialized){for(var a=this.filteredrows.length;a--;)t(this.collection.data[this.filteredrows[a]])===!0&&n.push(this.filteredrows[a]);return this.filteredrows=n,this}for(var i=this.collection.data.length;i--;)t(this.collection.data[i])===!0&&n.push(i);return this.filteredrows=n,this.filterInitialized=!0,this}for(var o=this.collection.data.length;o--;)t(this.collection.data[o])===!0&&n.push(this.collection.data[o]);return n}catch(l){throw l}},p.prototype.data=function(){var e=[];if(this.searchIsChained&&!this.filterInitialized){if(0===this.filteredrows.length)return this.collection.data;this.filterInitialized=!0}var t,n=this.collection.data,a=this.filteredrows,i=this.filteredrows.length;for(t=0;i>t;t++)e.push(n[a[t]]);return e},p.prototype.update=function(e){if("function"!=typeof e)throw"Argument is not a function";this.searchIsChained&&!this.filterInitialized&&0===this.filteredrows.length&&(this.filteredrows=Object.keys(this.collection.data));for(var t=this.filteredrows.length,n=this.collection.data,a=0;t>a;a++)e(n[this.filteredrows[a]]),this.collection.update(n[this.filteredrows[a]]);return this},p.prototype.remove=function(){this.searchIsChained&&!this.filterInitialized&&0===this.filteredrows.length&&(this.filteredrows=Object.keys(this.collection.data));for(var e=this.filteredrows.length,t=0;e>t;t++)this.collection.remove(this.filteredrows[t]);return this.filteredrows=[],this},p.prototype.mapReduce=function(e,t){try{return t(this.data().map(e))}catch(n){throw n}},p.prototype.eqJoin=function(e,t,n,a){var i,o,l,s=[],r=[],c=[],u="function"==typeof t,d="function"==typeof n,f={};if(s=this.data(),i=s.length,e instanceof p)r=e.data();else{if(!Array.isArray(e))throw new TypeError("joinData needs to be an array or result set");r=e}o=r.length;for(var h=0;o>h;h++)l=d?n(r[h]):r[h][n],f[l]=r[h];a||(a=function(e,t){return{left:e,right:t}});for(var _=0;i>_;_++)l=u?t(s[_]):s[_][t],c.push(a(s[_],f[l]||{}));return this.collection=new m("joinData"),this.collection.insert(c),this.filteredrows=[],this.filterInitialized=!1,this},p.prototype.map=function(e){var t=this.data().map(e);return this.collection=new m("mappedData"),this.collection.insert(t),this.filteredrows=[],this.filterInitialized=!1,this},u.prototype=new l,u.prototype.rematerialize=function(e){var t,n,a;if(e=e||{},this.resultdata=[],this.resultsdirty=!0,this.resultset=new p(this.collection),(this.sortFunction||this.sortCriteria)&&(this.sortDirty=!0),e.hasOwnProperty("removeWhereFilters"))for(t=this.filterPipeline.length,n=t;n--;)"where"===this.filterPipeline[n].type&&(n!==this.filterPipeline.length-1&&(this.filterPipeline[n]=this.filterPipeline[this.filterPipeline.length-1]),this.filterPipeline.length--);var i=this.filterPipeline;for(this.filterPipeline=[],t=i.length,a=0;t>a;a++)this.applyFind(i[a].val);return this.data(),this.emit("rebuild",this),this},u.prototype.branchResultset=function(e,t){var n=this.resultset.copy();return"undefined"==typeof e?n:("string"==typeof e&&this.collection.transforms.hasOwnProperty(e)&&(e=this.collection.transforms[e]),"object"==typeof e&&Array.isArray(e)?n.transform(e,t):n)},u.prototype.toJSON=function(){var e=new u(this.collection,this.name,this.options);return e.resultset=this.resultset,e.resultdata=[],e.resultsdirty=!0,e.filterPipeline=this.filterPipeline,e.sortFunction=this.sortFunction,e.sortCriteria=this.sortCriteria,e.sortDirty=this.sortDirty,e.collection=null,e},u.prototype.applySort=function(e){return this.sortFunction=e,this.sortCriteria=null,this.queueSortPhase(),this},u.prototype.applySimpleSort=function(e,t){return"undefined"==typeof t&&(t=!1),this.sortCriteria=[[e,t]],this.sortFunction=null,this.queueSortPhase(),this},u.prototype.applySortCriteria=function(e){return this.sortCriterial=e,this.sortFunction=null,this.queueSortPhase(),this},u.prototype.startTransaction=function(){return this.cachedresultset=this.resultset.copy(),this},u.prototype.commit=function(){return this.cachedresultset=null,this},u.prototype.rollback=function(){return this.resultset=this.cachedresultset,this.options.persistent&&(this.resultdata=this.resultset.data(),this.emit("rebuild",this)),this},u.prototype.applyFind=function(e){return this.filterPipeline.push({type:"find",val:e}),this.resultset.find(e),(this.sortFunction||this.sortCriteria)&&(this.sortDirty=!0,this.queueSortPhase()),this.options.persistent&&(this.resultsdirty=!0,this.queueSortPhase()),this},u.prototype.applyWhere=function(e){return this.filterPipeline.push({type:"where",val:e}),this.resultset.where(e),(this.sortFunction||this.sortCriteria)&&(this.sortDirty=!0,this.queueSortPhase()),this.options.persistent&&(this.resultsdirty=!0,this.queueSortPhase()),this},u.prototype.data=function(){return(this.sortDirty||this.resultsdirty||!this.resultset.filterInitialized)&&this.performSortPhase(),this.options.persistent?this.resultdata:this.resultset.data()},u.prototype.queueRebuildEvent=function(){var e=this;this.rebuildPending||(this.rebuildPending=!0,setTimeout(function(){e.rebuildPending=!1,e.emit("rebuild",this)},1))},u.prototype.queueSortPhase=function(){var e=this;this.sortDirty||(this.sortDirty=!0,"active"===this.options.sortPriority?setTimeout(function(){
e.performSortPhase()},1):this.queueRebuildEvent())},u.prototype.performSortPhase=function(){if(this.sortDirty||this.resultsdirty||!this.resultset.filterInitialized){if(this.sortFunction&&this.resultset.sort(this.sortFunction),this.sortCriteria&&this.resultset.compoundsort(this.sortCriteria),!this.options.persistent)return void(this.sortDirty=!1);this.resultdata=this.resultset.data(),this.resultsdirty=!1,this.sortDirty=!1,this.emit("rebuild",this)}},u.prototype.evaluateDocument=function(e){var t=this.resultset.filteredrows,n=t.indexOf(e),a=t.length,i=new p(this.collection);i.filteredrows=[e],i.filterInitialized=!0;for(var o=0;o<this.filterPipeline.length;o++)switch(this.filterPipeline[o].type){case"find":i.find(this.filterPipeline[o].val);break;case"where":i.where(this.filterPipeline[o].val)}var l=0===i.filteredrows.length?-1:0;return-1!=n||-1!=l?-1===n&&-1!==l?(t.push(e),this.options.persistent&&this.resultdata.push(this.collection.data[e]),void(this.sortFunction||this.sortCriteria?this.queueSortPhase():this.queueRebuildEvent())):-1!==n&&-1===l?(a-1>n?(t[n]=t[a-1],t.length=a-1,this.options.persistent&&(this.resultdata[n]=this.resultdata[a-1],this.resultdata.length=a-1)):(t.length=a-1,this.options.persistent&&(this.resultdata.length=a-1)),void(this.sortFunction||this.sortCriteria?this.queueSortPhase():this.queueRebuildEvent())):-1!==n&&-1!==l?(this.options.persistent&&(this.resultdata[n]=this.collection.data[e]),void(this.sortFunction||this.sortCriteria?this.queueSortPhase():this.queueRebuildEvent())):void 0:void 0},u.prototype.removeDocument=function(e){var t,n=this.resultset.filteredrows,a=n.indexOf(e),i=n.length;for(-1!==a&&(i-1>a?(n[a]=n[i-1],n.length=i-1,this.options.persistent&&(this.resultdata[a]=this.resultdata[i-1],this.resultdata.length=i-1)):(n.length=i-1,this.options.persistent&&(this.resultdata.length=i-1)),(this.sortFunction||this.sortCriteria)&&this.queueSortPhase()),i=n.length,t=0;i>t;t++)n[t]>e&&n[t]--},u.prototype.mapReduce=function(e,t){try{return t(this.data().map(e))}catch(n){throw n}},m.prototype=new l,m.prototype.addTransform=function(e,t){if(this.transforms.hasOwnProperty(e))throw new Error("a transform by that name already exists");this.transforms[e]=t},m.prototype.setTransform=function(e,t){this.transforms[e]=t},m.prototype.removeTransform=function(e){delete transforms[e]},m.prototype.byExample=function(e){var t,n,a;a=[];for(t in e)e.hasOwnProperty(t)&&a.push((n={},n[t]=e[t],n));return{$and:a}},m.prototype.findObject=function(e){return this.findOne(this.byExample(e))},m.prototype.findObjects=function(e){return this.find(this.byExample(e))},m.prototype.ensureIndex=function(n,a){if("undefined"==typeof a&&(a=!1),null===n||void 0===n)throw"Attempting to set index without an associated property";if(!this.binaryIndices.hasOwnProperty(n)||a||this.binaryIndices[n].dirty){this.binaryIndices[n]={name:n,dirty:!0,values:[]};var i,o=this.data.length,l=0;for(i=this.binaryIndices[n],l;o>l;l+=1)i.values.push(l);var s=function(n,a){return function(i,o){var l=a.data[i],s=a.data[o];return l[n]===s[n]?0:t(l[n],s[n])?1:e(l[n],s[n])?-1:void 0}}(n,this);i.values.sort(s),i.dirty=!1,this.dirty=!0}},m.prototype.ensureUniqueIndex=function(e){var t=this.constraints.unique[e];t||(-1==this.uniqueNames.indexOf(e)&&this.uniqueNames.push(e),this.constraints.unique[e]=t=new E(e));return this.data.forEach(function(e){t.set(e)}),t},m.prototype.ensureAllIndexes=function(e){for(var t=Object.keys(this.binaryIndices),n=t.length;n--;)this.ensureIndex(t[n],e)},m.prototype.flagBinaryIndexesDirty=function(){for(var e=Object.keys(this.binaryIndices),t=e.length;t--;)this.binaryIndices[e[t]].dirty=!0},m.prototype.count=function(){return this.data.length},m.prototype.ensureId=function(){var e=this.data.length,t=0;for(this.idIndex=[],t;e>t;t+=1)this.idIndex.push(this.data[t].$loki)},m.prototype.ensureIdAsync=function(e){this.async(function(){this.ensureId()},e)},m.prototype.addDynamicView=function(e,t){var n=new u(this,e,t);return this.DynamicViews.push(n),n},m.prototype.removeDynamicView=function(e){for(var t=0;t<this.DynamicViews.length;t++)this.DynamicViews[t].name===e&&this.DynamicViews.splice(t,1)},m.prototype.getDynamicView=function(e){for(var t=0;t<this.DynamicViews.length;t++)if(this.DynamicViews[t].name===e)return this.DynamicViews[t];return null},m.prototype.findAndUpdate=function(e,t){var n,a=this.where(e),i=0;try{for(i;i<a.length;i++)n=t(a[i]),this.update(n)}catch(o){this.rollback(),console.error(o.message)}},m.prototype.insert=function(e){if(!e){var t=new Error("Object cannot be null");throw this.emit("error",t),t}var n,a=this,i=Array.isArray(e)?e:[e],o=[];return i.forEach(function(e){if("object"!=typeof e)throw new TypeError("Document needs to be an object");return n=a.cloneObjects?JSON.parse(JSON.stringify(e)):e,"undefined"==typeof n.meta&&(n.meta={revision:0,created:0}),a.emit("pre-insert",n),a.add(n)?(a.emit("insert",n),void o.push(n)):void 0}),1===o.length?o[0]:o},m.prototype.clear=function(){this.data=[],this.idIndex=[],this.binaryIndices={},this.cachedIndex=null,this.cachedData=null,this.maxId=0,this.DynamicViews=[],this.dirty=!0},m.prototype.update=function(e){if(Object.keys(this.binaryIndices).length>0&&this.flagBinaryIndexesDirty(),Array.isArray(e)){var t=0,n=e.length;for(t;n>t;t+=1)this.update(e[t])}else{if(!e.hasOwnProperty("$loki"))throw"Trying to update unsynced document. Please save the document first by using insert() or addMany()";try{this.startTransaction();var a,i,o=this.get(e.$loki,!0),l=this;if(!o)throw new Error("Trying to update a document not in collection.");this.emit("pre-update",e),a=o[0],Object.keys(this.constraints.unique).forEach(function(e){l.constraints.unique[e].update(a)}),i=o[1],this.data[i]=e;for(var s=0;s<this.DynamicViews.length;s++)this.DynamicViews[s].evaluateDocument(i);this.idIndex[i]=a.$loki,this.commit(),this.dirty=!0,this.emit("update",e)}catch(r){throw this.rollback(),console.error(r.message),this.emit("error",r),r}}},m.prototype.add=function(e){var t=this.DynamicViews.length;if("object"!=typeof e)throw"Object being added needs to be an object";if(Object.keys(this.binaryIndices).length>0&&this.flagBinaryIndexesDirty(),"undefined"!=typeof e.$loki)throw"Document is already in collection, please use update()";try{this.startTransaction(),this.maxId++,isNaN(this.maxId)&&(this.maxId=this.data[this.data.length-1].$loki+1),e.$loki=this.maxId,e.meta.version=0;var n=this;Object.keys(this.constraints.unique).forEach(function(t){n.constraints.unique[t].set(e)}),this.data.push(e);for(var a=0;t>a;a++)this.DynamicViews[a].evaluateDocument(this.data.length-1);return this.idIndex.push(e.$loki),this.commit(),this.dirty=!0,e}catch(i){this.rollback(),console.error(i.message)}},m.prototype.removeWhere=function(e){var t;t="function"==typeof e?this.data.filter(e):new p(this,e);for(var n=t.length;n--;)this.remove(t[n]);var a;for(a in this.DynamicViews)this.DynamicViews[a].rematerialize()},m.prototype.removeDataOnly=function(){this.removeWhere(function(e){return!0})},m.prototype.remove=function(e){if("number"==typeof e&&(e=this.get(e)),"object"!=typeof e)throw new Error("Parameter is not an object");if(Array.isArray(e)){var t=0,n=e.length;for(t;n>t;t+=1)this.remove(e[t])}else{if(!e.hasOwnProperty("$loki"))throw new Error("Object is not a document stored in the collection");Object.keys(this.binaryIndices).length>0&&this.flagBinaryIndexesDirty();try{this.startTransaction();var a=this.get(e.$loki,!0),i=a[1],o=this;Object.keys(this.constraints.unique).forEach(function(t){null!==e[t]&&"undefined"!=typeof e[t]&&o.constraints.unique[t].remove(e[t])});for(var l=0;l<this.DynamicViews.length;l++)this.DynamicViews[l].removeDocument(i);return this.data.splice(i,1),this.idIndex.splice(i,1),this.commit(),this.dirty=!0,this.emit("delete",a[0]),delete e.$loki,delete e.meta,e}catch(s){return this.rollback(),console.error(s.message),this.emit("error",s),null}}},m.prototype.get=function(e,t){var n=t||!1,a=this.idIndex,i=a.length-1,o=0,l=Math.floor(o+(i-o)/2);if(e="number"==typeof e?e:parseInt(e,10),isNaN(e))throw"Passed id is not an integer";for(;a[o]<a[i];)l=Math.floor((o+i)/2),a[l]<e?o=l+1:i=l;return i===o&&a[o]===e?n?[this.data[o],o]:this.data[o]:null},m.prototype.by=function(e,t){var n;return t?this.constraints.unique[e].get(t):(n=this,function(t){return n.by(e,t)})},m.prototype.findOne=function(e){var t=new p(this,e,null,!0);return Array.isArray(t)&&0===t.length?null:t},m.prototype.chain=function(e,t){var n=new p(this,null,null);return"undefined"==typeof e?n:("string"==typeof e&&this.transforms.hasOwnProperty(e)&&(e=this.transforms[e]),"object"==typeof e&&Array.isArray(e)?n.transform(e,t):null)},m.prototype.find=function(e){return"undefined"==typeof e&&(e="getAll"),new p(this,e,null)},m.prototype.findOneUnindexed=function(e,t){for(var n,a=this.data.length;a--;)if(this.data[a][e]===t)return n=this.data[a];return null},m.prototype.startTransaction=function(){if(this.transactional){this.cachedData=i(this.data,"parse-stringify"),this.cachedIndex=this.idIndex,this.cachedBinaryIndex=this.binaryIndices;for(var e=0;e<this.DynamicViews.length;e++)this.DynamicViews[e].startTransaction()}},m.prototype.commit=function(){if(this.transactional){this.cachedData=null,this.cachedIndex=null,this.cachedBinaryIndices=null;for(var e=0;e<this.DynamicViews.length;e++)this.DynamicViews[e].commit()}},m.prototype.rollback=function(){if(this.transactional){null!==this.cachedData&&null!==this.cachedIndex&&(this.data=this.cachedData,this.idIndex=this.cachedIndex,this.binaryIndices=this.cachedBinaryIndex);for(var e=0;e<this.DynamicViews.length;e++)this.DynamicViews[e].rollback()}},m.prototype.async=function(e,t){setTimeout(function(){if("function"!=typeof e)throw"Argument passed for async execution is not a function";e(),t()},0)},m.prototype.where=function(e){return new p(this,null,e)},m.prototype.mapReduce=function(e,t){try{return t(this.data.map(e))}catch(n){throw n}},m.prototype.eqJoin=function(e,t,n,a){return new p(this).eqJoin(e,t,n,a)},m.prototype.stages={},m.prototype.getStage=function(e){return this.stages[e]||(this.stages[e]={}),this.stages[e]},m.prototype.commitLog=[],m.prototype.stage=function(e,t){var n=JSON.parse(JSON.stringify(t));return this.getStage(e)[t.$loki]=n,n},m.prototype.commitStage=function(e,t){var n,a=this.getStage(e),i=(new Date).getTime();for(n in a)this.update(a[n]),this.commitLog.push({timestamp:i,message:t,data:JSON.parse(JSON.stringify(a[n]))});this.stages[e]={}},m.prototype.no_op=function(){},m.prototype.extract=function(e){var t=0,n=this.data.length,a=d(e),i=[];for(t;n>t;t+=1)i.push(k(this.data[t],e,a));return i},m.prototype.max=function(e){return Math.max.apply(null,this.extract(e))},m.prototype.min=function(e){return Math.min.apply(null,this.extract(e))},m.prototype.maxRecord=function(e){var t,n=0,a=this.data.length,i=d(e),o={index:0,value:void 0};for(n;a>n;n+=1)void 0!==t?t<k(this.data[n],e,i)&&(t=k(this.data[n],e,i),o.index=this.data[n].$loki):(t=k(this.data[n],e,i),o.index=this.data[n].$loki);return o.value=t,o},m.prototype.minRecord=function(e){var t,n=0,a=this.data.length,i=d(e),o={index:0,value:void 0};for(n;a>n;n+=1)void 0!==t?t>k(this.data[n],e,i)&&(t=k(this.data[n],e,i),o.index=this.data[n].$loki):(t=k(this.data[n],e,i),o.index=this.data[n].$loki);return o.value=t,o},m.prototype.extractNumerical=function(e){return this.extract(e).map(f).filter(Number).filter(function(e){return!isNaN(e)})},m.prototype.avg=function(e){return v(this.extractNumerical(e))},m.prototype.stdDev=function(e){return g(this.extractNumerical(e))},m.prototype.mode=function(e){var t={},n=this.extract(e);n.forEach(function(e){t[e]?t[e]+=1:t[e]=1});var a,i,o;for(i in t)a?a<t[i]&&(o=i):(o=i,a=t[i]);return o},m.prototype.median=function(e){var t=this.extractNumerical(e);t.sort(_);var n=Math.floor(t.length/2);return t.length%2?t[n]:(t[n-1]+t[n])/2},x.prototype={keys:[],values:[],sort:function(e,t){return t>e?-1:e>t?1:0},setSort:function(e){this.bs=new b(e)},bs:function(){return new b(this.sort)},set:function(e,t){var n=this.bs(this.keys,e);n.found?this.values[n.index]=t:(this.keys.splice(n.index,0,e),this.values.splice(n.index,0,t))},get:function(e){return this.values[y(this.keys,e,this.sort).index]}},E.prototype.keyMap={},E.prototype.lokiMap={},E.prototype.set=function(e){if(null!==e[this.field]&&"undefined"!=typeof e[this.field]){if(this.keyMap[e[this.field]])throw new Error("Duplicate key for property "+this.field+": "+e[this.field]);this.keyMap[e[this.field]]=e,this.lokiMap[e.$loki]=e[this.field]}},E.prototype.get=function(e){return this.keyMap[e]},E.prototype.byId=function(e){return this.keyMap[this.lokiMap[e]]},E.prototype.update=function(e){if(this.lokiMap[e.$loki]!==e[this.field]){var t=this.lokiMap[e.$loki];this.set(e),this.keyMap[t]=void 0}else this.keyMap[e[this.field]]=e},E.prototype.remove=function(e){var t=this.keyMap[e];if(null===t||"undefined"==typeof t)throw new Error("Key is not in unique index: "+this.field);this.keyMap[e]=void 0,this.lokiMap[t.$loki]=void 0},E.prototype.clear=function(){this.keyMap={},this.lokiMap={}},N.prototype={set:function(e,t){this.index[e]?this.index[e].push(t):this.index[e]=[t]},remove:function(e,t){var n=this.index[e];for(var a in n)n[a]==t&&n.splice(a,1);n.length<1&&(this.index[e]=void 0)},get:function(e){return this.index[e]},clear:function(e){this.index={}}},I.prototype={keys:[],values:[],sort:function(e,t){return t>e?-1:e>t?1:0},bs:function(){return new b(this.sort)},setSort:function(e){this.bs=new b(e)},set:function(e,t){var n=y(this.keys,e,this.sort);n.found?this.values[n.index].push(t):(this.keys.splice(n.index,0,e),this.values.splice(n.index,0,[t]))},get:function(e){var t=y(this.keys,e,this.sort);return t.found?this.values[t.index]:[]},getLt:function(e){var t=y(this.keys,e,this.sort),n=t.index;return t.found&&n--,this.getAll(e,0,n)},getGt:function(e){var t=y(this.keys,e,this.sort),n=t.index;return t.found&&n++,this.getAll(e,n,this.keys.length)},getAll:function(e,t,n){for(var a=[],i=t;n>i;i++)a=a.concat(this.values[i]);return a},getPos:function(e){return y(this.keys,e,this.sort)},remove:function(e,t){var n=y(this.keys,e,this.sort).index,a=this.values[n];for(var i in a)a[i]==t&&a.splice(i,1);a.length<1&&(this.keys.splice(n,1),this.values.splice(n,1))},clear:function(){this.keys=[],this.values=[]}},s.Collection=m,s.KeyValueStore=x,s}()})}});
//# sourceMappingURL=vendors.js.map