!function(e){function t(e){var t=document.getElementsByTagName("head")[0],n=document.createElement("script");n.type="text/javascript",n.charset="utf-8",n.src=d.p+""+e+"."+k+".hot-update.js",t.appendChild(n)}function n(e){if("undefined"==typeof XMLHttpRequest)return e(new Error("No browser support"));try{var t=new XMLHttpRequest,n=d.p+""+k+".hot-update.json";t.open("GET",n,!0),t.timeout=1e4,t.send(null)}catch(a){return e(a)}t.onreadystatechange=function(){if(4===t.readyState)if(0===t.status)e(new Error("Manifest request to "+n+" timed out."));else if(404===t.status)e();else if(200!==t.status&&304!==t.status)e(new Error("Manifest request to "+n+" failed."));else{try{var a=JSON.parse(t.responseText)}catch(s){return void e(s)}e(null,a)}}}function a(e){var t=O[e];if(!t)return d;var n=function(n){return t.hot.active?O[n]?(O[n].parents.indexOf(e)<0&&O[n].parents.push(e),t.children.indexOf(n)<0&&t.children.push(n)):b=[e]:(console.warn("[HMR] unexpected require("+n+") from disposed module "+e),b=[]),d(n)};for(var a in d)Object.prototype.hasOwnProperty.call(d,a)&&(n[a]=d[a]);return n.e=function(e,t){"ready"===E&&i("prepare"),I++,d.e(e,function(){function a(){I--,"prepare"===E&&(w[e]||c(e),0===I&&0===N&&u())}try{t.call(null,n)}finally{a()}})},n}function s(e){var t={_acceptedDependencies:{},_declinedDependencies:{},_selfAccepted:!1,_selfDeclined:!1,_disposeHandlers:[],active:!0,accept:function(e,n){if("undefined"==typeof e)t._selfAccepted=!0;else if("function"==typeof e)t._selfAccepted=e;else if("object"==typeof e)for(var a=0;a<e.length;a++)t._acceptedDependencies[e[a]]=n;else t._acceptedDependencies[e]=n},decline:function(e){if("undefined"==typeof e)t._selfDeclined=!0;else if("number"==typeof e)t._declinedDependencies[e]=!0;else for(var n=0;n<e.length;n++)t._declinedDependencies[e[n]]=!0},dispose:function(e){t._disposeHandlers.push(e)},addDisposeHandler:function(e){t._disposeHandlers.push(e)},removeDisposeHandler:function(e){var n=t._disposeHandlers.indexOf(e);n>=0&&t._disposeHandlers.splice(n,1)},check:r,apply:p,status:function(e){return e?void x.push(e):E},addStatusHandler:function(e){x.push(e)},removeStatusHandler:function(e){var t=x.indexOf(e);t>=0&&x.splice(t,1)},data:y[e]};return t}function i(e){E=e;for(var t=0;t<x.length;t++)x[t].call(null,e)}function o(e){var t=+e+""===e;return t?+e:e}function r(e,t){if("idle"!==E)throw new Error("check() is only allowed in idle status");"function"==typeof e?(g=!1,t=e):(g=e,t=t||function(e){if(e)throw e}),i("check"),n(function(e,n){if(e)return t(e);if(!n)return i("idle"),void t(null,null);D={},C={},w={};for(var a=0;a<n.c.length;a++)C[n.c[a]]=!0;v=n.h,i("prepare"),h=t,_={};for(var s in M)c(s);"prepare"===E&&0===I&&0===N&&u()})}function l(e,t){if(C[e]&&D[e]){D[e]=!1;for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(_[n]=t[n]);0===--N&&0===I&&u()}}function c(e){C[e]?(D[e]=!0,N++,t(e)):w[e]=!0}function u(){i("ready");var e=h;if(h=null,e)if(g)p(g,e);else{var t=[];for(var n in _)Object.prototype.hasOwnProperty.call(_,n)&&t.push(o(n));e(null,t)}}function p(t,n){function a(e){for(var t=[e],n={},a=t.slice();a.length>0;){var i=a.pop(),e=O[i];if(e&&!e.hot._selfAccepted){if(e.hot._selfDeclined)return new Error("Aborted because of self decline: "+i);if(0===i)return;for(var o=0;o<e.parents.length;o++){var r=e.parents[o],l=O[r];if(l.hot._declinedDependencies[i])return new Error("Aborted because of declined dependency: "+i+" in "+r);t.indexOf(r)>=0||(l.hot._acceptedDependencies[i]?(n[r]||(n[r]=[]),s(n[r],[i])):(delete n[r],t.push(r),a.push(r)))}}}return[t,n]}function s(e,t){for(var n=0;n<t.length;n++){var a=t[n];e.indexOf(a)<0&&e.push(a)}}if("ready"!==E)throw new Error("apply() is only allowed in ready status");"function"==typeof t?(n=t,t={}):t&&"object"==typeof t?n=n||function(e){if(e)throw e}:(t={},n=n||function(e){if(e)throw e});var r={},l=[],c={};for(var u in _)if(Object.prototype.hasOwnProperty.call(_,u)){var p=o(u),m=a(p);if(!m){if(t.ignoreUnaccepted)continue;return i("abort"),n(new Error("Aborted because "+p+" is not accepted"))}if(m instanceof Error)return i("abort"),n(m);c[p]=_[p],s(l,m[0]);for(var p in m[1])Object.prototype.hasOwnProperty.call(m[1],p)&&(r[p]||(r[p]=[]),s(r[p],m[1][p]))}for(var f=[],h=0;h<l.length;h++){var p=l[h];O[p]&&O[p].hot._selfAccepted&&f.push({module:p,errorHandler:O[p].hot._selfAccepted})}i("dispose");for(var g=l.slice();g.length>0;){var p=g.pop(),x=O[p];if(x){for(var N={},I=x.hot._disposeHandlers,w=0;w<I.length;w++){var D=I[w];D(N)}y[p]=N,x.hot.active=!1,delete O[p];for(var w=0;w<x.children.length;w++){var C=O[x.children[w]];if(C){var M=C.parents.indexOf(p);M>=0&&C.parents.splice(M,1)}}}}for(var p in r)if(Object.prototype.hasOwnProperty.call(r,p))for(var x=O[p],R=r[p],w=0;w<R.length;w++){var P=R[w],M=x.children.indexOf(P);M>=0&&x.children.splice(M,1)}i("apply"),k=v;for(var p in c)Object.prototype.hasOwnProperty.call(c,p)&&(e[p]=c[p]);var T=null;for(var p in r)if(Object.prototype.hasOwnProperty.call(r,p)){for(var x=O[p],R=r[p],S=[],h=0;h<R.length;h++){var P=R[h],D=x.hot._acceptedDependencies[P];S.indexOf(D)>=0||S.push(D)}for(var h=0;h<S.length;h++){var D=S[h];try{D(r)}catch(A){T||(T=A)}}}for(var h=0;h<f.length;h++){var V=f[h],p=V.module;b=[p];try{d(p)}catch(A){if("function"==typeof V.errorHandler)try{V.errorHandler(A)}catch(A){T||(T=A)}else T||(T=A)}}return T?(i("fail"),n(T)):(i("idle"),void n(null,l))}function d(t){if(O[t])return O[t].exports;var n=O[t]={exports:{},id:t,loaded:!1,hot:s(t),parents:b,children:[]};return e[t].call(n.exports,n,n.exports,a(t)),n.loaded=!0,n.exports}var m=window.webpackJsonp;window.webpackJsonp=function(t,n){for(var a,s,i=0,o=[];i<t.length;i++)s=t[i],M[s]&&o.push.apply(o,M[s]),M[s]=0;for(a in n)e[a]=n[a];for(m&&m(t,n);o.length;)o.shift().call(null,d);return n[0]?(O[0]=0,d(0)):void 0};var f=this.webpackHotUpdate;this.webpackHotUpdate=function(e,t){l(e,t),f&&f(e,t)};var h,_,v,g=!0,k="9ee540ed09d75df2f6c3",y={},b=[],x=[],E="idle",N=0,I=0,w={},D={},C={},O={},M={2:0};return d.e=function(e,t){if(0===M[e])return t.call(null,d);if(void 0!==M[e])M[e].push(t);else{M[e]=[t];var n=document.getElementsByTagName("head")[0],a=document.createElement("script");a.type="text/javascript",a.charset="utf-8",a.async=!0,a.src=d.p+""+e+"."+({0:"bundle",1:"onlyDevServer",3:"webpackDevServer"}[e]||e)+".js",n.appendChild(a)}},d.m=e,d.c=O,d.p="",d.h=function(){return k},a(0)(0)}({0:function(e,t,n){e.exports=n(192)},192:function(e,t){!function(n,a){"function"==typeof define&&define.amd?define([],a):"object"==typeof t?e.exports=a():n.loki=a()}(this,function(){return function(){"use strict";function e(e,t,n){return e===t?n?!0:!1:void 0===e?!0:void 0===t?!1:null===e?!0:null===t?!1:t>e}function t(e,t,n){return e===t?n?!0:!1:void 0===e?!1:void 0===t?!0:null===e?!1:null===t?!0:e>t}function n(n,a,s){return n===a?0:s?e(n,a)?1:-1:t(n,a)?1:-1}function a(e,t){return Array.isArray(e)?function(t){return-1!==e.indexOf(t)}:e&&"string"==typeof e?function(t){return-1!==e.indexOf(t)}:e&&"object"==typeof e?function(t){return e.hasOwnProperty(t)}:void 0}function s(e,t){var n,a=t||"parse-stringify";return"parse-stringify"===a&&(n=JSON.parse(JSON.stringify(e))),n}function i(){try{return"localStorage"in window&&null!==window.localStorage}catch(e){return!1}}function o(){}function r(e,t){this.filename=e||"loki.db",this.collections=[],this.databaseVersion=1.1,this.engineVersion=1.1,this.autosave=!1,this.autosaveInterval=5e3,this.autosaveHandle=null,this.options={},this.persistenceMethod=null,this.persistenceAdapter=null,this.events={init:[],flushChanges:[],close:[],changes:[],warning:[]};var n=function(){return"undefined"==typeof window?"NODEJS":"undefined"!=typeof global&&global.window?"NODEJS":"undefined"!=typeof document?-1===document.URL.indexOf("http://")&&-1===document.URL.indexOf("https://")?"CORDOVA":"BROWSER":"CORDOVA"};t&&t.hasOwnProperty("env")?this.ENV=t.env:this.ENV=n(),"undefined"===this.ENV&&(this.ENV="NODEJS"),this.configureOptions(t,!0),this.on("init",this.clearChanges)}function l(){this.fs=require("fs")}function c(){}function u(e,t,n,a){return this.collection=e,this.searchIsChained=!t&&!n,this.filteredrows=[],this.filterInitialized=!1,"undefined"!=typeof t&&null!==t?this.find(t,a):"undefined"!=typeof n&&null!==n?this.where(n):this}function p(e,t,n){this.collection=e,this.name=t,this.rebuildPending=!1,this.options=n||{},this.options.hasOwnProperty("persistent")||(this.options.persistent=!1),this.options.hasOwnProperty("sortPriority")||(this.options.sortPriority="passive"),this.resultset=new u(e),this.resultdata=[],this.resultsdirty=!1,this.cachedresultset=null,this.filterPipeline=[],this.sortFunction=null,this.sortCriteria=null,this.sortDirty=!1,this.events={rebuild:[]}}function d(e,t){function n(e,t,n){p.changes.push({name:e,operation:t,obj:JSON.parse(JSON.stringify(n))})}function a(){p.changes=[]}function s(e){e&&(e.meta||(e.meta={}),e.meta.created=(new Date).getTime(),e.meta.revision=0)}function i(e){e&&(e.meta.updated=(new Date).getTime(),e.meta.revision+=1)}function o(e){n(p.name,"I",e)}function r(e){n(p.name,"U",e)}function l(e){s(e),o(e)}function c(e){i(e),r(e)}function u(){f=p.disableChangesApi?s:l,h=p.disableChangesApi?i:c}this.name=e,this.data=[],this.idIndex=[],this.binaryIndices={},this.constraints={unique:{},exact:{}},this.uniqueNames=[],this.transforms={},this.objType=e,this.dirty=!0,this.cachedIndex=null,this.cachedBinaryIndex=null,this.cachedData=null;var p=this;t=t||{},t.hasOwnProperty("unique")&&(Array.isArray(t.unique)||(t.unique=[t.unique]),t.unique.forEach(function(e){p.uniqueNames.push(e),p.constraints.unique[e]=new E(e)})),t.hasOwnProperty("exact")&&t.exact.forEach(function(e){p.constraints.exact[e]=new N(e)}),this.transactional=t.hasOwnProperty("transactional")?t.transactional:!1,this.cloneObjects=t.hasOwnProperty("clone")?t.clone:!1,this.asyncListeners=t.hasOwnProperty("asyncListeners")?t.asyncListeners:!1,this.disableChangesApi=t.hasOwnProperty("disableChangesApi")?t.disableChangesApi:!0,this.maxId=0,this.DynamicViews=[],this.events={insert:[],update:[],"pre-insert":[],"pre-update":[],close:[],flushbuffer:[],error:[],"delete":[],warning:[]},this.changes=[],this.ensureId();var d=[];if(t&&t.indices)if("[object Array]"===Object.prototype.toString.call(t.indices))d=t.indices;else{if("string"!=typeof t.indices)throw new TypeError("Indices needs to be a string or an array of strings");d=[t.indices]}for(var m=0;m<d.length;m++)this.ensureIndex(d[m]);this.getChanges=function(){return p.changes},this.flushChanges=a;var f,h;u(),this.setChangesApi=function(e){p.disableChangesApi=!e,u()},this.on("insert",function(e){f(e)}),this.on("update",function(e){h(e)}),this.on("delete",function(e){p.disableChangesApi||n(p.name,"R",e)}),this.on("warning",console.warn),a()}function m(e){return-1!==e.indexOf(".")}function f(e){return parseFloat(e,10)}function h(e,t){return e+t}function _(e,t){return e-t}function v(e){return e.reduce(h,0)/e.length}function g(e){var t=v(e),n=e.map(function(e){var n=e-t,a=n*n;return a}),a=v(n),s=Math.sqrt(a);return s}function k(e,t,n){if(n===!1)return e[t];for(var a=t.split("."),s=e;a.length>0;)s=s[a.shift()];return s}function y(e,t,n){for(var a,s,i=0,o=e.length;o>i;){if(s=(i+o)/2|0,a=n.apply(null,[t,e[s]]),0===a)return{found:!0,index:s};0>a?o=s:i=s+1}return{found:!1,index:o}}function b(e){return function(t,n){return y(t,n,e)}}function x(){}function E(e){this.field=e,this.keyMap={},this.lokiMap={}}function N(e){this.index={},this.field=e}function I(e){this.field=e}var w={copyProperties:function(e,t){var n;for(n in e)t[n]=e[n]},resolveTransformObject:function(e,t,n){var a,s;if("number"!=typeof n&&(n=0),++n>=10)return e;for(a in e)"string"==typeof e[a]&&0===e[a].indexOf("[%lktxp]")?(s=e[a].substring(8),t.hasOwnProperty(s)&&(e[a]=t[s])):"object"==typeof e[a]&&(e[a]=w.resolveTransformObject(e[a],t,n));return e},resolveTransformParams:function(e,t){var n,a,s=[];if("undefined"==typeof t)return e;for(n=0;n<e.length;n++)a=JSON.parse(JSON.stringify(e[n])),s.push(w.resolveTransformObject(a,t));return s}},D={$eq:function(e,t){return e===t},$gt:function(e,n){return t(e,n)},$gte:function(e,n){return t(e,n,!0)},$lt:function(t,n){return e(t,n)},$lte:function(t,n){return e(t,n,!0)},$ne:function(e,t){return e!==t},$regex:function(e,t){return t.test(e)},$in:function(e,t){return t.indexOf(e)>-1},$containsAny:function(e,t){var n;return Array.isArray(t)||(t=[t]),n=a(e,t)||function(){return!1},t.reduce(function(e,t){return e?e:n(t)},!1)},$contains:function(e,t){var n;return Array.isArray(t)||(t=[t]),n=a(e,t)||function(){return!1},t.reduce(function(e,t){return e?n(t):e},!0)}},C={$eq:D.$eq,$gt:D.$gt,$gte:D.$gte,$lt:D.$lt,$lte:D.$lte,$ne:D.$ne,$regex:D.$regex,$in:D.$in,$contains:D.$contains,$containsAny:D.$containsAny},O=["$eq","$gt","$gte","$lt","$lte"];return o.prototype.events={},o.prototype.asyncListeners=!1,o.prototype.on=function(e,t){var n=this.events[e];return n||(n=this.events[e]=[]),n.push(t),t},o.prototype.emit=function(e,t){var n=this;if(!e||!this.events[e])throw new Error("No event "+e+" defined");this.events[e].forEach(function(e){n.asyncListeners?setTimeout(function(){e(t)},1):e(t)})},o.prototype.removeListener=function(e,t){if(this.events[e]){var n=this.events[e];n.splice(n.indexOf(t),1)}},r.prototype=new o,r.prototype.getIndexedAdapter=function(){var e;return"function"==typeof require&&(e=require("./loki-indexed-adapter.js")),e},r.prototype.configureOptions=function(e,t){var n={NODEJS:"fs",BROWSER:"localStorage",CORDOVA:"localStorage"},a={fs:l,localStorage:c};if(this.options={},this.persistenceMethod=null,this.persistenceAdapter=null,"undefined"!=typeof e){if(this.options=e,this.options.hasOwnProperty("persistenceMethod")&&"function"==typeof a[e.persistenceMethod]&&(this.persistenceMethod=e.persistenceMethod,this.persistenceAdapter=new a[e.persistenceMethod]),this.options.hasOwnProperty("adapter")&&(this.persistenceMethod="adapter",this.persistenceAdapter=e.adapter),e.hasOwnProperty("autoload")&&"undefined"!=typeof t&&t){var s=this;setTimeout(function(){s.loadDatabase(e,e.autoloadCallback)},1)}this.options.hasOwnProperty("autosaveInterval")&&(this.autosaveDisable(),this.autosaveInterval=parseInt(this.options.autosaveInterval,10)),this.options.hasOwnProperty("autosave")&&this.options.autosave&&(this.autosaveDisable(),this.autosave=!0,this.options.hasOwnProperty("autosaveCallback")?this.autosaveEnable(e,e.autosaveCallback):this.autosaveEnable())}null===this.persistenceAdapter&&(this.persistenceMethod=n[this.ENV],this.persistenceMethod&&(this.persistenceAdapter=new a[this.persistenceMethod]))},r.prototype.anonym=function(e,t){var n=new d("anonym",t);return n.insert(e),n},r.prototype.addCollection=function(e,t){var n=new d(e,t);return this.collections.push(n),n},r.prototype.loadCollection=function(e){if(!e.name)throw new Error("Collection must have a name property to be loaded");this.collections.push(e)},r.prototype.getCollection=function(e){var t,n=this.collections.length;for(t=0;n>t;t+=1)if(this.collections[t].name===e)return this.collections[t];return this.emit("warning","collection "+e+" not found"),null},r.prototype.listCollections=function(){for(var e=this.collections.length,t=[];e--;)t.push({name:this.collections[e].name,type:this.collections[e].objType,count:this.collections[e].data.length});return t},r.prototype.removeCollection=function(e){var t,n=this.collections.length;for(t=0;n>t;t+=1)if(this.collections[t].name===e)return void this.collections.splice(t,1)},r.prototype.getName=function(){return this.name},r.prototype.serializeReplacer=function(e,t){switch(e){case"autosaveHandle":case"persistenceAdapter":case"constraints":return null;default:return t}},r.prototype.serialize=function(){return JSON.stringify(this,this.serializeReplacer)},r.prototype.toJson=r.prototype.serialize,r.prototype.loadJSON=function(e,t){0===e.length&&(e=JSON.stringify({}));var n,a,s,i,o=JSON.parse(e),r=0,l=o.collections?o.collections.length:0;for(this.name=o.name,this.databaseVersion=1,o.hasOwnProperty("databaseVersion")&&(this.databaseVersion=o.databaseVersion),this.collections=[],r;l>r;r+=1){if(n=o.collections[r],a=this.addCollection(n.name),s=n.data.length,i=0,t&&t.hasOwnProperty(n.name)){var c=t[n.name].inflate?t[n.name].inflate:w.copyProperties;for(i;s>i;i++){var u=new t[n.name].proto;c(n.data[i],u),a.data[i]=u}}else for(i;s>i;i++)a.data[i]=n.data[i];if(a.transactional=n.transactional,a.asyncListeners=n.asyncListeners,a.disableChangesApi=n.disableChangesApi,a.cloneObjects=n.cloneObjects,a.maxId=0===n.data.length?0:n.maxId,a.idIndex=n.idIndex,"undefined"!=typeof n.binaryIndices&&(a.binaryIndices=n.binaryIndices),"undefined"!=typeof n.transforms&&(a.transforms=n.transforms),a.ensureId(),a.uniqueNames=[],n.hasOwnProperty("uniqueNames"))for(a.uniqueNames=n.uniqueNames,i=0;i<a.uniqueNames.length;i++)a.ensureUniqueIndex(a.uniqueNames[i]);if("undefined"!=typeof n.DynamicViews)for(var p=0;p<n.DynamicViews.length;p++){var d=n.DynamicViews[p],m=a.addDynamicView(d.name,d.options);m.resultdata=d.resultdata,m.resultsdirty=d.resultsdirty,m.filterPipeline=d.filterPipeline,m.sortCriteria=d.sortCriteria,m.sortFunction=null,m.sortDirty=d.sortDirty,m.resultset.filteredrows=d.resultset.filteredrows,m.resultset.searchIsChained=d.resultset.searchIsChained,m.resultset.filterInitialized=d.resultset.filterInitialized,m.rematerialize({removeWhereFilters:!0})}}},r.prototype.close=function(e){this.autosave&&(this.autosaveDisable(),this.autosaveDirty()&&this.saveDatabase()),e&&this.on("close",e),this.emit("close")},r.prototype.generateChangesNotification=function(e){function t(e){return e.name}var n=[],a=e||this.collections.map(t);return this.collections.forEach(function(e){-1!==a.indexOf(t(e))&&(n=n.concat(e.getChanges()))}),n},r.prototype.serializeChanges=function(e){return JSON.stringify(this.generateChangesNotification(e))},r.prototype.clearChanges=function(){this.collections.forEach(function(e){e.flushChanges&&e.flushChanges()})},l.prototype.loadDatabase=function(e,t){this.fs.readFile(e,{encoding:"utf8"},function(e,n){t(e?new Error(e):n)})},l.prototype.saveDatabase=function(e,t,n){this.fs.writeFile(e,t,n)},c.prototype.loadDatabase=function(e,t){t(i()?localStorage.getItem(e):new Error("localStorage is not available"))},c.prototype.saveDatabase=function(e,t,n){i()?(localStorage.setItem(e,t),n(null)):n(new Error("localStorage is not available"))},r.prototype.loadDatabase=function(e,t){var n=t||function(e,t){if(e)throw e},a=this;null!==this.persistenceAdapter?this.persistenceAdapter.loadDatabase(this.filename,function(t){"string"==typeof t?(a.loadJSON(t,e||{}),n(null)):(console.warn("lokijs loadDatabase : Database not found"),n("object"==typeof t?t:"Database not found"))}):n(new Error("persistenceAdapter not configured"))},r.prototype.saveDatabase=function(e){var t=e||function(e){if(e)throw e},n=this;null!==this.persistenceAdapter?this.persistenceAdapter.saveDatabase(this.filename,n.serialize(),function(){n.autosaveClearFlags(),t(null)}):t(new Error("persistenceAdapter not configured"))},r.prototype.save=r.prototype.saveDatabase,r.prototype.autosaveDirty=function(){for(var e=0;e<this.collections.length;e++)if(this.collections[e].dirty)return!0;return!1},r.prototype.autosaveClearFlags=function(){for(var e=0;e<this.collections.length;e++)this.collections[e].dirty=!1},r.prototype.autosaveEnable=function(e,t){this.autosave=!0;var n=5e3,a=this;"undefined"!=typeof this.autosaveInterval&&null!==this.autosaveInterval&&(n=this.autosaveInterval),this.autosaveHandle=setInterval(function(){a.autosaveDirty()&&a.saveDatabase(t)},n)},r.prototype.autosaveDisable=function(){"undefined"!=typeof this.autosaveHandle&&null!==this.autosaveHandle&&(clearInterval(this.autosaveHandle),this.autosaveHandle=null)},u.prototype.toJSON=function(){var e=this.copy();return e.collection=null,e},u.prototype.limit=function(e){this.searchIsChained&&!this.filterInitialized&&0===this.filteredrows.length&&(this.filteredrows=Object.keys(this.collection.data));var t=this.copy();return t.filteredrows=t.filteredrows.slice(0,e),t},u.prototype.offset=function(e){this.searchIsChained&&!this.filterInitialized&&0===this.filteredrows.length&&(this.filteredrows=Object.keys(this.collection.data));var t=this.copy();return t.filteredrows=t.filteredrows.splice(e,t.filteredrows.length),t},u.prototype.copy=function(){var e=new u(this.collection,null,null);return e.filteredrows=this.filteredrows.slice(),e.filterInitialized=this.filterInitialized,e},u.prototype.branch=u.prototype.copy,u.prototype.transform=function(e,t){var n,a,s=this;for("undefined"!=typeof t&&(e=w.resolveTransformParams(e,t)),n=0;n<e.length;n++)switch(a=e[n],a.type){case"find":s.find(a.value);break;case"where":s.where(a.value);break;case"simplesort":s.simplesort(a.property,a.desc);break;case"compoundsort":s.compoundsort(a.value);break;case"sort":s.sort(a.value);break;case"limit":s=s.limit(a.value);break;case"offset":s=s.offset(a.value);break;case"map":s=s.map(a.value);break;case"eqJoin":s=s.eqJoin(a.joinData,a.leftJoinKey,a.rightJoinKey,a.mapFun);break;case"mapReduce":s=s.mapReduce(a.mapFunction,a.reduceFunction);break;case"update":s.update(a.value);break;case"remove":s.remove()}return s},u.prototype.sort=function(e){this.searchIsChained&&!this.filterInitialized&&0===this.filteredrows.length&&(this.filteredrows=Object.keys(this.collection.data));var t=function(e,t){return function(n,a){var s=t.collection.data[n],i=t.collection.data[a];return e(s,i)}}(e,this);return this.filteredrows.sort(t),this},u.prototype.simplesort=function(e,t){this.searchIsChained&&!this.filterInitialized&&0===this.filteredrows.length&&(this.filteredrows=Object.keys(this.collection.data)),"undefined"==typeof t&&(t=!1);var a=function(e,t,a){return function(s,i){var o=a.collection.data[s],r=a.collection.data[i];return n(o[e],r[e],t)}}(e,t,this);return this.filteredrows.sort(a),this},u.prototype.compoundeval=function(e,t,a){var s=e.length;if(0===s)throw new Error("Invalid call to compoundeval, need at least one property");var i=!1,o=e[0];return"string"!=typeof o&&Array.isArray(o)&&(i=o[1],o=o[0]),t[o]===a[o]?1===s?0:this.compoundeval(e.slice(1),t,a,i):n(t[o],a[o],i)},u.prototype.compoundsort=function(e){this.searchIsChained&&!this.filterInitialized&&0===this.filteredrows.length&&(this.filteredrows=Object.keys(this.collection.data));var t=function(e,t){return function(n,a){var s=t.collection.data[n],i=t.collection.data[a];return t.compoundeval(e,s,i)}}(e,this);return this.filteredrows.sort(t),this},u.prototype.calculateRange=function(n,a,s){var i=this.collection.data,o=this.collection.binaryIndices[a].values,r=0,l=o.length-1,c=null,u=0,p=o.length-1;if(0===i.length)return[0,-1];var d=i[o[r]][a],m=i[o[l]][a];switch(n){case"$eq":if(e(s,d)||t(s,m))return[0,-1];break;case"$gt":if(t(s,m,!0))return[0,-1];break;case"$gte":if(t(s,m))return[0,-1];break;case"$lt":if(e(s,d,!0))return[0,-1];if(e(m,s))return[0,i.length-1];break;case"$lte":if(e(s,d))return[0,-1];if(e(m,s,!0))return[0,i.length-1]}for(;l>r;)c=Math.floor((r+l)/2),e(i[o[c]][a],s)?r=c+1:l=c;for(u=r,r=0,l=o.length-1;l>r;)c=Math.floor((r+l)/2),e(s,i[o[c]][a])?l=c:r=c+1;p=l;var f=i[o[u]][a],h=i[o[p]][a];switch(n){case"$eq":return f!==s?[0,-1]:(h!==s&&p--,[u,p]);case"$gt":return e(h,s,!0)?[0,-1]:[p,i.length-1];case"$gte":return e(f,s)?[0,-1]:[u,i.length-1];case"$lt":return 0===u&&e(f,s)?[0,0]:[0,u-1];case"$lte":return h!==s&&p--,0===p&&e(h,s)?[0,0]:[0,p];default:return[0,i.length-1]}},u.prototype.findOr=function(e){var t=0,n=0,a=null,s=[],i=null;if(this.filterInitialized){for(s=[],n=0;n<e.length;n++)for(i=this.branch(),i.find(e[n]),i.data(),a=i.filteredrows,t=0;t<a.length;t++)-1===s.indexOf(a[t])&&s.push(a[t]);this.filteredrows=s}else for(n=0;n<e.length;n++)for(i=this.collection.chain(),i.find(e[n]),i.data(),a=i.filteredrows,t=0;t<a.length;t++)-1===this.filteredrows.indexOf(a[t])&&this.filteredrows.push(a[t]);return this.filterInitialized=!0,this},u.prototype.findAnd=function(e){for(var t=0;t<e.length;t++)this.find(e[t]);return this},u.prototype.dotSubScan=function(e,t,n,a){var s,i,o,r=null,l=t.split(".");for(s=0;s<l.length;s++)if(o=l[s],r){for(i=0;i<r.length;i++)if(n(r[i][o],a))return!0}else e=e[o],Array.isArray(e)&&(r=e);return n(e,a)},u.prototype.find=function(e,t){if(0===this.collection.data.length)return this.searchIsChained?(this.filteredrows=[],this.filterInitialized=!0,this):[];var n,a,s,i,o,r,l,c,u=e||"getAll",p=!1,d=[],m=null,f=!0;t=t||!1;for(i in u){f=!1;break}if(f&&(u="getAll"),"getAll"===u)return this.searchIsChained?(this.filteredrows=Object.keys(this.collection.data),this):this.collection.data;var h=!1;for(i in u)if(u.hasOwnProperty(i)){if(n=i,"$and"===i)return this.searchIsChained?(this.findAnd(u[i]),t&&this.filteredrows.length>1&&(this.filteredrows=this.filteredrows.slice(0,1)),this):(d=this.collection.chain().findAnd(u[i]).data(),t?0===d.length?[]:d[0]:d);if("$or"===i)return this.searchIsChained?(this.findOr(u[i]),t&&this.filteredrows.length>1&&(this.filteredrows=this.filteredrows.slice(0,1)),this):(d=this.collection.chain().findOr(u[i]).data(),t?0===d.length?[]:d[0]:d);if(-1!=i.indexOf(".")&&(h=!0),null===u[i]||"object"!=typeof u[i])s="$eq",a=u[i];else{if("object"!=typeof u[i])throw"Do not know what you want to do.";for(o in u[i])u[i].hasOwnProperty(o)&&(s=o,a=u[i][o])}break}if("$regex"===s&&(a=new RegExp(a)),null===this.collection.data)throw new TypeError;if((!this.searchIsChained||this.searchIsChained&&!this.filterInitialized)&&-1!==O.indexOf(s)&&this.collection.binaryIndices.hasOwnProperty(n)&&(this.collection.ensureIndex(n),p=!0,m=this.collection.binaryIndices[n]),r=C[s],this.searchIsChained){if(this.filterInitialized){if(p)for(l=m,c=this.filteredrows.length;c--;)r(l[this.filteredrows[c]],a)&&d.push(this.filteredrows[c]);else if(l=this.collection.data,c=this.filteredrows.length,h)for(;c--;)this.dotSubScan(l[this.filteredrows[c]],n,r,a)&&d.push(this.filteredrows[c]);else for(;c--;)r(l[this.filteredrows[c]][n],a)&&d.push(this.filteredrows[c]);return this.filteredrows=d,this}if(p){l=this.collection.data;for(var _=this.calculateRange(s,n,a,this),v=_[0];v<=_[1];v++)d.push(m.values[v]);this.filteredrows=d}else if(l=this.collection.data,c=l.length,h)for(;c--;)this.dotSubScan(l[c],n,r,a)&&d.push(c);else for(;c--;)r(l[c][n],a)&&d.push(c);return this.filteredrows=d,this.filterInitialized=!0,this}if(p){l=this.collection.data;var g=this.calculateRange(s,n,a,this);if(t)return-1!==g[1]?l[m.values[g[0]]]:[];for(c=g[0];c<=g[1];c++)d.push(l[m.values[c]]);this.filteredrows=d}else{if(l=this.collection.data,c=l.length,t){if(h){for(;c--;)if(this.dotSubScan(l[c],n,r,a))return l[c]}else for(;c--;)if(r(l[c][n],a))return l[c];return[]}if(h)for(;c--;)this.dotSubScan(l[c],n,r,a)&&d.push(l[c]);else for(;c--;)r(l[c][n],a)&&d.push(l[c])}return d},u.prototype.where=function(e){var t,n=[];if("function"!=typeof e)throw"Argument is not a stored view or a function";t=e;try{if(this.searchIsChained){if(this.filterInitialized){for(var a=this.filteredrows.length;a--;)t(this.collection.data[this.filteredrows[a]])===!0&&n.push(this.filteredrows[a]);return this.filteredrows=n,this}for(var s=this.collection.data.length;s--;)t(this.collection.data[s])===!0&&n.push(s);return this.filteredrows=n,this.filterInitialized=!0,this}for(var i=this.collection.data.length;i--;)t(this.collection.data[i])===!0&&n.push(this.collection.data[i]);return n}catch(o){throw o}},u.prototype.data=function(){var e=[];if(this.searchIsChained&&!this.filterInitialized){if(0===this.filteredrows.length)return this.collection.data;this.filterInitialized=!0}var t,n=this.collection.data,a=this.filteredrows,s=this.filteredrows.length;for(t=0;s>t;t++)e.push(n[a[t]]);return e},u.prototype.update=function(e){if("function"!=typeof e)throw"Argument is not a function";this.searchIsChained&&!this.filterInitialized&&0===this.filteredrows.length&&(this.filteredrows=Object.keys(this.collection.data));for(var t=this.filteredrows.length,n=this.collection.data,a=0;t>a;a++)e(n[this.filteredrows[a]]),this.collection.update(n[this.filteredrows[a]]);return this},u.prototype.remove=function(){this.searchIsChained&&!this.filterInitialized&&0===this.filteredrows.length&&(this.filteredrows=Object.keys(this.collection.data));for(var e=this.filteredrows.length,t=0;e>t;t++)this.collection.remove(this.filteredrows[t]);return this.filteredrows=[],this},u.prototype.mapReduce=function(e,t){try{return t(this.data().map(e))}catch(n){throw n}},u.prototype.eqJoin=function(e,t,n,a){var s,i,o,r=[],l=[],c=[],p="function"==typeof t,m="function"==typeof n,f={};if(r=this.data(),s=r.length,e instanceof u)l=e.data();else{if(!Array.isArray(e))throw new TypeError("joinData needs to be an array or result set");l=e}i=l.length;for(var h=0;i>h;h++)o=m?n(l[h]):l[h][n],f[o]=l[h];a||(a=function(e,t){return{left:e,right:t}});for(var _=0;s>_;_++)o=p?t(r[_]):r[_][t],c.push(a(r[_],f[o]||{}));return this.collection=new d("joinData"),this.collection.insert(c),this.filteredrows=[],this.filterInitialized=!1,this},u.prototype.map=function(e){var t=this.data().map(e);return this.collection=new d("mappedData"),this.collection.insert(t),this.filteredrows=[],this.filterInitialized=!1,this},p.prototype=new o,p.prototype.rematerialize=function(e){var t,n,a;if(e=e||{},this.resultdata=[],this.resultsdirty=!0,this.resultset=new u(this.collection),(this.sortFunction||this.sortCriteria)&&(this.sortDirty=!0),e.hasOwnProperty("removeWhereFilters"))for(t=this.filterPipeline.length,n=t;n--;)"where"===this.filterPipeline[n].type&&(n!==this.filterPipeline.length-1&&(this.filterPipeline[n]=this.filterPipeline[this.filterPipeline.length-1]),this.filterPipeline.length--);var s=this.filterPipeline;for(this.filterPipeline=[],t=s.length,a=0;t>a;a++)this.applyFind(s[a].val);return this.data(),this.emit("rebuild",this),this},p.prototype.branchResultset=function(e,t){var n=this.resultset.copy();return"undefined"==typeof e?n:("string"==typeof e&&this.collection.transforms.hasOwnProperty(e)&&(e=this.collection.transforms[e]),"object"==typeof e&&Array.isArray(e)?n.transform(e,t):n)},p.prototype.toJSON=function(){var e=new p(this.collection,this.name,this.options);return e.resultset=this.resultset,e.resultdata=[],e.resultsdirty=!0,e.filterPipeline=this.filterPipeline,e.sortFunction=this.sortFunction,e.sortCriteria=this.sortCriteria,e.sortDirty=this.sortDirty,e.collection=null,e},p.prototype.applySort=function(e){return this.sortFunction=e,this.sortCriteria=null,this.queueSortPhase(),this},p.prototype.applySimpleSort=function(e,t){return"undefined"==typeof t&&(t=!1),this.sortCriteria=[[e,t]],this.sortFunction=null,this.queueSortPhase(),this},p.prototype.applySortCriteria=function(e){return this.sortCriterial=e,this.sortFunction=null,this.queueSortPhase(),this},p.prototype.startTransaction=function(){return this.cachedresultset=this.resultset.copy(),this},p.prototype.commit=function(){return this.cachedresultset=null,this},p.prototype.rollback=function(){return this.resultset=this.cachedresultset,this.options.persistent&&(this.resultdata=this.resultset.data(),this.emit("rebuild",this)),this},p.prototype.applyFind=function(e){return this.filterPipeline.push({type:"find",val:e}),this.resultset.find(e),(this.sortFunction||this.sortCriteria)&&(this.sortDirty=!0,this.queueSortPhase()),this.options.persistent&&(this.resultsdirty=!0,this.queueSortPhase()),this},p.prototype.applyWhere=function(e){return this.filterPipeline.push({type:"where",val:e}),this.resultset.where(e),(this.sortFunction||this.sortCriteria)&&(this.sortDirty=!0,this.queueSortPhase()),this.options.persistent&&(this.resultsdirty=!0,this.queueSortPhase()),this},p.prototype.data=function(){return(this.sortDirty||this.resultsdirty||!this.resultset.filterInitialized)&&this.performSortPhase(),this.options.persistent?this.resultdata:this.resultset.data()},p.prototype.queueRebuildEvent=function(){var e=this;this.rebuildPending||(this.rebuildPending=!0,setTimeout(function(){e.rebuildPending=!1,e.emit("rebuild",this)},1))},p.prototype.queueSortPhase=function(){var e=this;this.sortDirty||(this.sortDirty=!0,"active"===this.options.sortPriority?setTimeout(function(){
e.performSortPhase()},1):this.queueRebuildEvent())},p.prototype.performSortPhase=function(){if(this.sortDirty||this.resultsdirty||!this.resultset.filterInitialized){if(this.sortFunction&&this.resultset.sort(this.sortFunction),this.sortCriteria&&this.resultset.compoundsort(this.sortCriteria),!this.options.persistent)return void(this.sortDirty=!1);this.resultdata=this.resultset.data(),this.resultsdirty=!1,this.sortDirty=!1,this.emit("rebuild",this)}},p.prototype.evaluateDocument=function(e){var t=this.resultset.filteredrows,n=t.indexOf(e),a=t.length,s=new u(this.collection);s.filteredrows=[e],s.filterInitialized=!0;for(var i=0;i<this.filterPipeline.length;i++)switch(this.filterPipeline[i].type){case"find":s.find(this.filterPipeline[i].val);break;case"where":s.where(this.filterPipeline[i].val)}var o=0===s.filteredrows.length?-1:0;return-1!=n||-1!=o?-1===n&&-1!==o?(t.push(e),this.options.persistent&&this.resultdata.push(this.collection.data[e]),void(this.sortFunction||this.sortCriteria?this.queueSortPhase():this.queueRebuildEvent())):-1!==n&&-1===o?(a-1>n?(t[n]=t[a-1],t.length=a-1,this.options.persistent&&(this.resultdata[n]=this.resultdata[a-1],this.resultdata.length=a-1)):(t.length=a-1,this.options.persistent&&(this.resultdata.length=a-1)),void(this.sortFunction||this.sortCriteria?this.queueSortPhase():this.queueRebuildEvent())):-1!==n&&-1!==o?(this.options.persistent&&(this.resultdata[n]=this.collection.data[e]),void(this.sortFunction||this.sortCriteria?this.queueSortPhase():this.queueRebuildEvent())):void 0:void 0},p.prototype.removeDocument=function(e){var t,n=this.resultset.filteredrows,a=n.indexOf(e),s=n.length;for(-1!==a&&(s-1>a?(n[a]=n[s-1],n.length=s-1,this.options.persistent&&(this.resultdata[a]=this.resultdata[s-1],this.resultdata.length=s-1)):(n.length=s-1,this.options.persistent&&(this.resultdata.length=s-1)),(this.sortFunction||this.sortCriteria)&&this.queueSortPhase()),s=n.length,t=0;s>t;t++)n[t]>e&&n[t]--},p.prototype.mapReduce=function(e,t){try{return t(this.data().map(e))}catch(n){throw n}},d.prototype=new o,d.prototype.addTransform=function(e,t){if(this.transforms.hasOwnProperty(e))throw new Error("a transform by that name already exists");this.transforms[e]=t},d.prototype.setTransform=function(e,t){this.transforms[e]=t},d.prototype.removeTransform=function(e){delete transforms[e]},d.prototype.byExample=function(e){var t,n,a;a=[];for(t in e)e.hasOwnProperty(t)&&a.push((n={},n[t]=e[t],n));return{$and:a}},d.prototype.findObject=function(e){return this.findOne(this.byExample(e))},d.prototype.findObjects=function(e){return this.find(this.byExample(e))},d.prototype.ensureIndex=function(n,a){if("undefined"==typeof a&&(a=!1),null===n||void 0===n)throw"Attempting to set index without an associated property";if(!this.binaryIndices.hasOwnProperty(n)||a||this.binaryIndices[n].dirty){this.binaryIndices[n]={name:n,dirty:!0,values:[]};var s,i=this.data.length,o=0;for(s=this.binaryIndices[n],o;i>o;o+=1)s.values.push(o);var r=function(n,a){return function(s,i){var o=a.data[s],r=a.data[i];return o[n]===r[n]?0:t(o[n],r[n])?1:e(o[n],r[n])?-1:void 0}}(n,this);s.values.sort(r),s.dirty=!1,this.dirty=!0}},d.prototype.ensureUniqueIndex=function(e){var t=this.constraints.unique[e];t||(-1==this.uniqueNames.indexOf(e)&&this.uniqueNames.push(e),this.constraints.unique[e]=t=new E(e));return this.data.forEach(function(e){t.set(e)}),t},d.prototype.ensureAllIndexes=function(e){for(var t=Object.keys(this.binaryIndices),n=t.length;n--;)this.ensureIndex(t[n],e)},d.prototype.flagBinaryIndexesDirty=function(){for(var e=Object.keys(this.binaryIndices),t=e.length;t--;)this.binaryIndices[e[t]].dirty=!0},d.prototype.count=function(){return this.data.length},d.prototype.ensureId=function(){var e=this.data.length,t=0;for(this.idIndex=[],t;e>t;t+=1)this.idIndex.push(this.data[t].$loki)},d.prototype.ensureIdAsync=function(e){this.async(function(){this.ensureId()},e)},d.prototype.addDynamicView=function(e,t){var n=new p(this,e,t);return this.DynamicViews.push(n),n},d.prototype.removeDynamicView=function(e){for(var t=0;t<this.DynamicViews.length;t++)this.DynamicViews[t].name===e&&this.DynamicViews.splice(t,1)},d.prototype.getDynamicView=function(e){for(var t=0;t<this.DynamicViews.length;t++)if(this.DynamicViews[t].name===e)return this.DynamicViews[t];return null},d.prototype.findAndUpdate=function(e,t){var n,a=this.where(e),s=0;try{for(s;s<a.length;s++)n=t(a[s]),this.update(n)}catch(i){this.rollback(),console.error(i.message)}},d.prototype.insert=function(e){if(!e){var t=new Error("Object cannot be null");throw this.emit("error",t),t}var n,a=this,s=Array.isArray(e)?e:[e],i=[];return s.forEach(function(e){if("object"!=typeof e)throw new TypeError("Document needs to be an object");return n=a.cloneObjects?JSON.parse(JSON.stringify(e)):e,"undefined"==typeof n.meta&&(n.meta={revision:0,created:0}),a.emit("pre-insert",n),a.add(n)?(a.emit("insert",n),void i.push(n)):void 0}),1===i.length?i[0]:i},d.prototype.clear=function(){this.data=[],this.idIndex=[],this.binaryIndices={},this.cachedIndex=null,this.cachedData=null,this.maxId=0,this.DynamicViews=[],this.dirty=!0},d.prototype.update=function(e){if(Object.keys(this.binaryIndices).length>0&&this.flagBinaryIndexesDirty(),Array.isArray(e)){var t=0,n=e.length;for(t;n>t;t+=1)this.update(e[t])}else{if(!e.hasOwnProperty("$loki"))throw"Trying to update unsynced document. Please save the document first by using insert() or addMany()";try{this.startTransaction();var a,s,i=this.get(e.$loki,!0),o=this;if(!i)throw new Error("Trying to update a document not in collection.");this.emit("pre-update",e),a=i[0],Object.keys(this.constraints.unique).forEach(function(e){o.constraints.unique[e].update(a)}),s=i[1],this.data[s]=e;for(var r=0;r<this.DynamicViews.length;r++)this.DynamicViews[r].evaluateDocument(s);this.idIndex[s]=a.$loki,this.commit(),this.dirty=!0,this.emit("update",e)}catch(l){throw this.rollback(),console.error(l.message),this.emit("error",l),l}}},d.prototype.add=function(e){var t=this.DynamicViews.length;if("object"!=typeof e)throw"Object being added needs to be an object";if(Object.keys(this.binaryIndices).length>0&&this.flagBinaryIndexesDirty(),"undefined"!=typeof e.$loki)throw"Document is already in collection, please use update()";try{this.startTransaction(),this.maxId++,isNaN(this.maxId)&&(this.maxId=this.data[this.data.length-1].$loki+1),e.$loki=this.maxId,e.meta.version=0;var n=this;Object.keys(this.constraints.unique).forEach(function(t){n.constraints.unique[t].set(e)}),this.data.push(e);for(var a=0;t>a;a++)this.DynamicViews[a].evaluateDocument(this.data.length-1);return this.idIndex.push(e.$loki),this.commit(),this.dirty=!0,e}catch(s){this.rollback(),console.error(s.message)}},d.prototype.removeWhere=function(e){var t;t="function"==typeof e?this.data.filter(e):new u(this,e);for(var n=t.length;n--;)this.remove(t[n]);var a;for(a in this.DynamicViews)this.DynamicViews[a].rematerialize()},d.prototype.removeDataOnly=function(){this.removeWhere(function(e){return!0})},d.prototype.remove=function(e){if("number"==typeof e&&(e=this.get(e)),"object"!=typeof e)throw new Error("Parameter is not an object");if(Array.isArray(e)){var t=0,n=e.length;for(t;n>t;t+=1)this.remove(e[t])}else{if(!e.hasOwnProperty("$loki"))throw new Error("Object is not a document stored in the collection");Object.keys(this.binaryIndices).length>0&&this.flagBinaryIndexesDirty();try{this.startTransaction();var a=this.get(e.$loki,!0),s=a[1],i=this;Object.keys(this.constraints.unique).forEach(function(t){null!==e[t]&&"undefined"!=typeof e[t]&&i.constraints.unique[t].remove(e[t])});for(var o=0;o<this.DynamicViews.length;o++)this.DynamicViews[o].removeDocument(s);return this.data.splice(s,1),this.idIndex.splice(s,1),this.commit(),this.dirty=!0,this.emit("delete",a[0]),delete e.$loki,delete e.meta,e}catch(r){return this.rollback(),console.error(r.message),this.emit("error",r),null}}},d.prototype.get=function(e,t){var n=t||!1,a=this.idIndex,s=a.length-1,i=0,o=Math.floor(i+(s-i)/2);if(e="number"==typeof e?e:parseInt(e,10),isNaN(e))throw"Passed id is not an integer";for(;a[i]<a[s];)o=Math.floor((i+s)/2),a[o]<e?i=o+1:s=o;return s===i&&a[i]===e?n?[this.data[i],i]:this.data[i]:null},d.prototype.by=function(e,t){var n;return t?this.constraints.unique[e].get(t):(n=this,function(t){return n.by(e,t)})},d.prototype.findOne=function(e){var t=new u(this,e,null,!0);return Array.isArray(t)&&0===t.length?null:t},d.prototype.chain=function(e,t){var n=new u(this,null,null);return"undefined"==typeof e?n:("string"==typeof e&&this.transforms.hasOwnProperty(e)&&(e=this.transforms[e]),"object"==typeof e&&Array.isArray(e)?n.transform(e,t):null)},d.prototype.find=function(e){return"undefined"==typeof e&&(e="getAll"),new u(this,e,null)},d.prototype.findOneUnindexed=function(e,t){for(var n,a=this.data.length;a--;)if(this.data[a][e]===t)return n=this.data[a];return null},d.prototype.startTransaction=function(){if(this.transactional){this.cachedData=s(this.data,"parse-stringify"),this.cachedIndex=this.idIndex,this.cachedBinaryIndex=this.binaryIndices;for(var e=0;e<this.DynamicViews.length;e++)this.DynamicViews[e].startTransaction()}},d.prototype.commit=function(){if(this.transactional){this.cachedData=null,this.cachedIndex=null,this.cachedBinaryIndices=null;for(var e=0;e<this.DynamicViews.length;e++)this.DynamicViews[e].commit()}},d.prototype.rollback=function(){if(this.transactional){null!==this.cachedData&&null!==this.cachedIndex&&(this.data=this.cachedData,this.idIndex=this.cachedIndex,this.binaryIndices=this.cachedBinaryIndex);for(var e=0;e<this.DynamicViews.length;e++)this.DynamicViews[e].rollback()}},d.prototype.async=function(e,t){setTimeout(function(){if("function"!=typeof e)throw"Argument passed for async execution is not a function";e(),t()},0)},d.prototype.where=function(e){return new u(this,null,e)},d.prototype.mapReduce=function(e,t){try{return t(this.data.map(e))}catch(n){throw n}},d.prototype.eqJoin=function(e,t,n,a){return new u(this).eqJoin(e,t,n,a)},d.prototype.stages={},d.prototype.getStage=function(e){return this.stages[e]||(this.stages[e]={}),this.stages[e]},d.prototype.commitLog=[],d.prototype.stage=function(e,t){var n=JSON.parse(JSON.stringify(t));return this.getStage(e)[t.$loki]=n,n},d.prototype.commitStage=function(e,t){var n,a=this.getStage(e),s=(new Date).getTime();for(n in a)this.update(a[n]),this.commitLog.push({timestamp:s,message:t,data:JSON.parse(JSON.stringify(a[n]))});this.stages[e]={}},d.prototype.no_op=function(){},d.prototype.extract=function(e){var t=0,n=this.data.length,a=m(e),s=[];for(t;n>t;t+=1)s.push(k(this.data[t],e,a));return s},d.prototype.max=function(e){return Math.max.apply(null,this.extract(e))},d.prototype.min=function(e){return Math.min.apply(null,this.extract(e))},d.prototype.maxRecord=function(e){var t,n=0,a=this.data.length,s=m(e),i={index:0,value:void 0};for(n;a>n;n+=1)void 0!==t?t<k(this.data[n],e,s)&&(t=k(this.data[n],e,s),i.index=this.data[n].$loki):(t=k(this.data[n],e,s),i.index=this.data[n].$loki);return i.value=t,i},d.prototype.minRecord=function(e){var t,n=0,a=this.data.length,s=m(e),i={index:0,value:void 0};for(n;a>n;n+=1)void 0!==t?t>k(this.data[n],e,s)&&(t=k(this.data[n],e,s),i.index=this.data[n].$loki):(t=k(this.data[n],e,s),i.index=this.data[n].$loki);return i.value=t,i},d.prototype.extractNumerical=function(e){return this.extract(e).map(f).filter(Number).filter(function(e){return!isNaN(e)})},d.prototype.avg=function(e){return v(this.extractNumerical(e))},d.prototype.stdDev=function(e){return g(this.extractNumerical(e))},d.prototype.mode=function(e){var t={},n=this.extract(e);n.forEach(function(e){t[e]?t[e]+=1:t[e]=1});var a,s,i;for(s in t)a?a<t[s]&&(i=s):(i=s,a=t[s]);return i},d.prototype.median=function(e){var t=this.extractNumerical(e);t.sort(_);var n=Math.floor(t.length/2);return t.length%2?t[n]:(t[n-1]+t[n])/2},x.prototype={keys:[],values:[],sort:function(e,t){return t>e?-1:e>t?1:0},setSort:function(e){this.bs=new b(e)},bs:function(){return new b(this.sort)},set:function(e,t){var n=this.bs(this.keys,e);n.found?this.values[n.index]=t:(this.keys.splice(n.index,0,e),this.values.splice(n.index,0,t))},get:function(e){return this.values[y(this.keys,e,this.sort).index]}},E.prototype.keyMap={},E.prototype.lokiMap={},E.prototype.set=function(e){if(null!==e[this.field]&&"undefined"!=typeof e[this.field]){if(this.keyMap[e[this.field]])throw new Error("Duplicate key for property "+this.field+": "+e[this.field]);this.keyMap[e[this.field]]=e,this.lokiMap[e.$loki]=e[this.field]}},E.prototype.get=function(e){return this.keyMap[e]},E.prototype.byId=function(e){return this.keyMap[this.lokiMap[e]]},E.prototype.update=function(e){if(this.lokiMap[e.$loki]!==e[this.field]){var t=this.lokiMap[e.$loki];this.set(e),this.keyMap[t]=void 0}else this.keyMap[e[this.field]]=e},E.prototype.remove=function(e){var t=this.keyMap[e];if(null===t||"undefined"==typeof t)throw new Error("Key is not in unique index: "+this.field);this.keyMap[e]=void 0,this.lokiMap[t.$loki]=void 0},E.prototype.clear=function(){this.keyMap={},this.lokiMap={}},N.prototype={set:function(e,t){this.index[e]?this.index[e].push(t):this.index[e]=[t]},remove:function(e,t){var n=this.index[e];for(var a in n)n[a]==t&&n.splice(a,1);n.length<1&&(this.index[e]=void 0)},get:function(e){return this.index[e]},clear:function(e){this.index={}}},I.prototype={keys:[],values:[],sort:function(e,t){return t>e?-1:e>t?1:0},bs:function(){return new b(this.sort)},setSort:function(e){this.bs=new b(e)},set:function(e,t){var n=y(this.keys,e,this.sort);n.found?this.values[n.index].push(t):(this.keys.splice(n.index,0,e),this.values.splice(n.index,0,[t]))},get:function(e){var t=y(this.keys,e,this.sort);return t.found?this.values[t.index]:[]},getLt:function(e){var t=y(this.keys,e,this.sort),n=t.index;return t.found&&n--,this.getAll(e,0,n)},getGt:function(e){var t=y(this.keys,e,this.sort),n=t.index;return t.found&&n++,this.getAll(e,n,this.keys.length)},getAll:function(e,t,n){for(var a=[],s=t;n>s;s++)a=a.concat(this.values[s]);return a},getPos:function(e){return y(this.keys,e,this.sort)},remove:function(e,t){var n=y(this.keys,e,this.sort).index,a=this.values[n];for(var s in a)a[s]==t&&a.splice(s,1);a.length<1&&(this.keys.splice(n,1),this.values.splice(n,1))},clear:function(){this.keys=[],this.values=[]}},r.Collection=d,r.KeyValueStore=x,r}()})}});